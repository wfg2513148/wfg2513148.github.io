<!doctype html><html lang=zh-CN><meta charset=UTF-8><meta content="width=device-width" name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link crossorigin href=https://cdnjs.cloudflare.com rel=preconnect><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=_ZS2imU4knMegUWG7C18NQWvwS2icy1O2n7QI13BfDs name=google-site-verification><style>:root{--body-bg-color:#fff;--content-bg-color:#fff;--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#222;--btn-default-color:#fff;--btn-default-border-color:#222;--btn-default-hover-bg:#fff;--btn-default-hover-color:#222;--btn-default-hover-border-color:#222;--highlight-background:#f3f3f3;--highlight-foreground:#444;--highlight-gutter-background:#e1e1e1;--highlight-gutter-foreground:#555;color-scheme:light}html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{margin:.67em 0;font-size:2em}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background:0 0}abbr[title]{border-bottom:none;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:100%;line-height:1.15}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted buttontext}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;white-space:normal;max-width:100%;padding:0;display:table}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}details{display:block}summary{display:list-item}template,[hidden]{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}html,body{height:100%}body{background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);min-height:100%;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:1em;line-height:2;transition:padding .2s ease-in-out;position:relative}h1,h2,h3,h4,h5,h6{margin:30px 0 15px;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-weight:700;line-height:1.5}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}a{color:var(--link-color);cursor:pointer;overflow-wrap:break-word;border-bottom:1px solid #999;outline:0;text-decoration:none}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}iframe,img,video,embed{max-width:100%;margin-left:auto;margin-right:auto;display:block}hr{background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,#0000 4px 8px);border:0;height:3px;margin:40px 0}blockquote{color:var(--blockquote-color);border-left:4px solid #ddd;margin:0;padding:0 15px}blockquote cite:before{content:"-";padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}.table-container{overflow:auto}table{border-collapse:collapse;border-spacing:0;width:100%;margin:0 0 20px;font-size:.875em}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,th,td{padding:8px}th,td{border:1px solid #ddd;border-bottom-width:3px}th{padding-bottom:10px;font-weight:700}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);color:var(--btn-default-color);border-radius:0;padding:0 20px;font-size:.875em;line-height:2;transition:background-color .2s ease-in-out;display:inline-block}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.28571em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;width:100%;height:2px;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;display:block;position:relative;top:0;left:0}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{width:50%;top:2px;transform:rotate(-45deg)}.toggle.toggle-arrow :last-child{width:50%;top:-2px;transform:rotate(45deg)}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(-45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(45deg)}pre code.hljs{padding:1em;display:block;overflow-x:auto}code.hljs{padding:3px 5px}.hljs{color:#444;background:#f3f3f3}.hljs-comment{color:#697070}.hljs-tag,.hljs-punctuation{color:#444a}.hljs-tag .hljs-name,.hljs-tag .hljs-attr{color:#444}.hljs-keyword,.hljs-attribute,.hljs-selector-tag,.hljs-meta .hljs-keyword,.hljs-doctag,.hljs-name{font-weight:700}.hljs-type,.hljs-string,.hljs-number,.hljs-selector-id,.hljs-selector-class,.hljs-quote,.hljs-template-tag,.hljs-deletion{color:#800}.hljs-title,.hljs-section{color:#800;font-weight:700}.hljs-regexp,.hljs-symbol,.hljs-variable,.hljs-template-variable,.hljs-link,.hljs-selector-attr,.hljs-operator,.hljs-selector-pseudo{color:#ab5656}.hljs-literal{color:#695}.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-addition{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta .hljs-string{color:#38a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.highlight:hover .copy-btn,.code-container:hover .copy-btn{opacity:1}.code-container{position:relative}.copy-btn{color:#333;cursor:pointer;opacity:0;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;padding:2px 6px;font-size:.8125em;line-height:1.6;transition:opacity .2s ease-in-out;position:absolute;top:8px;right:4px}code,kbd,figure.highlight,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{margin:0 auto 20px;line-height:1.6}figure.highlight figcaption,pre .caption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);padding:.5em;font-size:.875em;line-height:1.2;display:flow-root}figure.highlight figcaption a,pre .caption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover{border-bottom-color:var(--highlight-foreground)}pre,code{font-family:consolas,Menlo,monospace,PingFang SC,Microsoft YaHei}code{overflow-wrap:break-word;border-radius:3px;padding:2px 4px;font-size:.875em}kbd{white-space:nowrap;border:2px solid #ccc;border-radius:.2em;padding:.1em .3em;font-family:inherit;box-shadow:.1em .1em .2em #0000001a}figure.highlight{position:relative;overflow:auto}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;width:auto;margin:0}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);text-align:right;padding-left:10px;padding-right:10px}figure.highlight .code pre{width:100%;padding-left:10px}figure.highlight .marked{background:#0000004d}pre .caption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre{padding:10px;overflow:auto}pre code{text-shadow:none;background:0 0;padding:0}.blockquote-center{text-align:center;border-left:0;margin:40px 0;padding:0;position:relative}.blockquote-center:before,.blockquote-center:after{opacity:.6;width:100%;line-height:1;position:absolute;left:0}.blockquote-center:before{text-align:left;content:"";border-top:1px solid #ccc;font-family:"Font Awesome 6 Free";font-weight:900;top:-20px}.blockquote-center:after{text-align:right;content:"";border-bottom:1px solid #ccc;font-family:"Font Awesome 6 Free";font-weight:900;bottom:-20px}.blockquote-center p,.blockquote-center div{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{gap:3px;margin-bottom:3px;display:flex}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{object-fit:cover;width:100%;height:100%;margin:0}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{grid-gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;margin-bottom:20px;padding:1rem;display:grid}.post-body .link-grid .link-grid-container{border:solid #ddd;min-width:0;min-height:5rem;padding:.5rem;transition:background .3s;position:relative;box-shadow:1rem 1rem .5rem #00000080}.post-body .link-grid .link-grid-container:hover{background:var(--card-bg-color);animation:.5s next-shake}.post-body .link-grid .link-grid-container:active{transform:translate(.2rem,.2rem);box-shadow:.5rem .5rem .25rem #00000080}.post-body .link-grid .link-grid-container .link-grid-image{box-sizing:border-box;border:1px solid #ddd;border-radius:50%;width:5rem;height:5rem;padding:3px;position:absolute}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{opacity:.7;font-size:.8em;line-height:1.3rem}.post-body .link-grid .link-grid-container a{border:0;width:100%;height:100%;position:absolute;top:0;left:0}@keyframes next-shake{0%{transform:translate(1pt,1pt)rotate(0)}10%{transform:translate(-1pt,-2pt)rotate(-1deg)}20%{transform:translate(-3pt)rotate(1deg)}30%{transform:translate(3pt,2pt)rotate(0)}40%{transform:translate(1pt,-1pt)rotate(1deg)}50%{transform:translate(-1pt,2pt)rotate(-1deg)}60%{transform:translate(-3pt,1pt)rotate(0)}70%{transform:translate(3pt,1pt)rotate(-1deg)}80%{transform:translate(-1pt,-1pt)rotate(1deg)}90%{transform:translate(1pt,2pt)rotate(0)}to{transform:translate(1pt,-2pt)rotate(-1deg)}}.post-body .note{border:1px solid #eee;border-left-width:5px;border-radius:3px;margin-bottom:20px;padding:1em;position:relative}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--body-bg-color);z-index:5;flex-wrap:wrap;justify-content:center;margin:0;padding:0;display:flex;position:sticky;top:0}@media (width<=413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{margin-bottom:5px;display:block}}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-top-width:3px;border-bottom-color:#ddd;border-radius:0;flex-grow:1;list-style-type:none}@media (width<=413px){.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-left-width:3px;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;text-align:center;padding:.25em .75em;line-height:1.8;transition:all .2s ease-out;display:block}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.28571em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd #0000}@media (width<=413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-top-color:#0000;border-radius:0}@media (width<=413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-top-color:#ddd;border-radius:0}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .prev,.pagination .next,.pagination .page-number,.pagination .space{margin:-1px 10px 0;padding:0 10px;display:inline-block}@media (width<=767px){.pagination .prev,.pagination .next,.pagination .page-number,.pagination .space{margin:0 5px}}.pagination .page-number.current{color:var(--content-bg-color);background:#ccc;border-color:#ccc}.pagination{text-align:center;border-top:1px solid #eee;margin:120px 0 0}.pagination .prev,.pagination .next,.pagination .page-number{border-top:1px solid #eee;border-bottom:0;transition:border-color .2s ease-in-out}.pagination .prev:hover,.pagination .next:hover,.pagination .page-number:hover{border-top-color:var(--link-hover-color)}@media (width<=767px){.pagination{border-top:0}.pagination .prev,.pagination .next,.pagination .page-number{border-top:0;border-bottom:1px solid #eee}.pagination .prev:hover,.pagination .next:hover,.pagination .page-number:hover{border-bottom-color:var(--link-hover-color)}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{flex-wrap:wrap;justify-content:center;margin:1em 0;display:flex}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (width<=991px){.headband{display:none}}.site-brand-container{flex-shrink:0;padding:0 10px;display:flex}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{text-align:center;flex-grow:1}@media (width<=767px){.site-meta{text-align:center}}.custom-logo-image{margin-top:20px}@media (width<=991px){.custom-logo-image{display:none}}.brand{color:var(--brand-color);border-bottom:0;padding:0 40px;display:inline-block}.brand:hover{color:var(--brand-hover-color)}.site-title{margin:0;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:1.375em;font-weight:400;line-height:1.5}.site-subtitle{color:#999;margin:10px 0;font-size:.8125em}.use-motion .site-title,.use-motion .site-subtitle,.use-motion .custom-logo-image{opacity:0;position:relative;top:-10px}.site-nav-toggle,.site-nav-right{display:none}@media (width<=767px){.site-nav-toggle,.site-nav-right{flex-direction:column;justify-content:center;display:flex}}.site-nav-toggle .toggle,.site-nav-right .toggle{color:var(--text-color);width:22px;padding:10px}.site-nav-toggle .toggle .toggle-line,.site-nav-right .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (width<=767px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{text-align:center;margin:0;padding:1em 0}.menu-item{margin:0 10px;list-style:none;display:inline-block}@media (width<=767px){.menu-item{margin-top:10px;display:block}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;font-size:.8125em;transition:border-color .2s ease-in-out;display:block}.menu-item a:hover,.menu-item a.menu-item-active{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{color:#555;text-shadow:none;background:#eee;border-radius:0;margin-left:.35em;padding:1px 4px;font-weight:700;line-height:1}.use-motion .menu-item{visibility:hidden}.sidebar{right:-320px}.sidebar-active .sidebar{right:0}.sidebar{z-index:20;background:#222;width:320px;max-height:100vh;transition:left .2s ease-out,right .2s ease-out;position:fixed;top:0;bottom:0;overflow-y:auto;box-shadow:inset 0 2px 6px #000}.sidebar a{color:#999;border-bottom-color:#555}.sidebar a:hover{color:#eee;border-bottom-color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{vertical-align:middle;border-bottom-color:#555;margin-bottom:10px;margin-right:10px;transition:all .2s ease-in-out;display:inline-block}.links-of-author a:before{content:" ";background:#ffc6ff;border-radius:50%;width:4px;height:4px;margin-right:3px;display:inline-block;transform:translateY(-2px)}.links-of-blogroll-item{padding:0 5px}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{opacity:0;visibility:hidden;z-index:10;background:#000;width:100%;height:100%;transition:visibility .4s,opacity .4s;position:fixed;top:0;left:0}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}.sidebar-inner{color:#999;text-align:center;flex-direction:column;justify-content:center;padding:18px 10px;display:flex}.sidebar-toggle{cursor:pointer;opacity:.8;z-index:30;background:#222;width:16px;height:16px;padding:5px;position:fixed;bottom:61px;right:30px}@media (width<=991px){.sidebar-toggle{right:20px}}.sidebar-toggle:hover{opacity:1}@media (width<=991px){.sidebar-toggle{opacity:1}}.sidebar-toggle:hover .toggle-line{background:#87daff}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{width:50%;top:2px;transform:rotate(-45deg)}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{width:50%;top:-2px;transform:rotate(45deg)}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(-45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(45deg)}.sidebar-nav{pointer-events:none;visibility:hidden;height:0;margin:0;padding-left:0;font-size:.875em;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}.sidebar-nav-active .sidebar-nav{pointer-events:unset;height:calc(2em + 1px);visibility:unset}.sidebar-nav li{color:#666;cursor:pointer;border-bottom:1px solid #0000;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out;display:inline-block}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#f5f5f5}.sidebar-toc-active .sidebar-nav-toc,.sidebar-overview-active .sidebar-nav-overview{color:#87daff;border-bottom-color:#87daff;transition-delay:.2s}.sidebar-toc-active .sidebar-nav-toc:hover,.sidebar-overview-active .sidebar-nav-overview:hover{color:#87daff}.sidebar-panel-container{flex:1;align-items:start;padding-top:0;transition:padding-top .2s ease-in-out;display:grid;overflow:hidden auto}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{opacity:0;pointer-events:none;visibility:hidden;grid-area:1/1;height:0;transition:opacity .2s ease-in-out,transform .2s ease-in-out,visibility .2s ease-in-out;animation:.2s ease-in-out deactivate-sidebar-panel;overflow:hidden;transform:translateY(0)}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{opacity:1;pointer-events:unset;height:auto;visibility:unset;transition-delay:.2s,.2s,0s;animation-name:activate-sidebar-panel;transform:translateY(0)}.sidebar-panel.site-overview-wrap{flex-direction:column;justify-content:flex-start;gap:10px;display:flex}@keyframes deactivate-sidebar-panel{0%{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{0%{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.post-toc{font-size:.875em}.post-toc ol{text-align:left;margin:0;padding:0 2px 0 10px;list-style:none}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:all .2s ease-in-out}.post-toc .nav-item{text-overflow:ellipsis;white-space:nowrap;line-height:1.8;overflow:hidden}.post-toc .nav .nav-child{--height:0;opacity:0;visibility:hidden;height:0;transition:all .2s ease-in-out;overflow:hidden}.post-toc .nav .active>.nav-child{height:var(--height,auto);opacity:1;visibility:unset}.post-toc .nav .active>a{color:#87daff;border-bottom-color:#87daff}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#87daff}.site-author-image{border:2px solid #333;border-radius:50%;max-width:96px;padding:2px}.site-author-name{color:#f5f5f5;margin:5px 0 0;font-weight:400}.site-description{color:#999;margin-top:5px;font-size:1em}.site-state{flex-wrap:wrap;justify-content:center;line-height:1.4;display:flex}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{font-size:1.25em;font-weight:600;display:block}.site-state-item-name{color:inherit;font-size:.875em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{color:#fc6423;cursor:pointer;background:0 0;border:1px solid #fc6423;border-radius:4px;padding:0 15px;line-height:2}.sidebar .sidebar-button button:hover{color:#fff;background:#fc6423}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-author a{font-size:.8125em}.links-of-author i[class^=fa]{margin-right:2px}.cc-license .cc-opacity{opacity:.7;border-bottom:0}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{flex-flow:column wrap;justify-content:center;gap:5px;margin:5px 0 0;padding:0;list-style:none;display:flex}.links-of-blogroll-item{max-width:100%}.links-of-blogroll-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;max-width:100%;display:inline-block;overflow:hidden}.footer{color:#999;padding:20px 0;font-size:.875em;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{position:absolute;bottom:0;left:0;right:0}.footer-inner{box-sizing:border-box;text-align:center;flex-direction:column;justify-content:center;width:700px;margin:0 auto;display:flex}@media (width<=767px){.footer-inner{width:auto}}@media (width>=1200px){.footer-inner{width:800px}}@media (width>=1600px){.footer-inner{width:900px}}.use-motion .footer{opacity:0}.languages{font-size:1.125em;display:inline-block;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{opacity:0;width:100%;height:100%;position:absolute;top:0;left:0}.with-love{color:red;margin:0 5px;animation:1.33s ease-in-out infinite icon-animate;display:inline-block}@keyframes icon-animate{0%,to{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,60%,80%{transform:scale(1.1)}50%,70%{transform:scale(1.1)}}.back-to-top{color:#fff;cursor:pointer;opacity:.8;z-index:30;background:#222;align-items:center;height:26px;font-size:12px;transition:bottom .2s ease-in-out;display:flex;position:fixed;bottom:-100px;right:30px}.back-to-top span{margin-right:8px;display:none}.back-to-top .fa{text-align:center;width:26px}@media (width<=991px){.back-to-top{right:20px}}.back-to-top:hover{opacity:1}@media (width<=991px){.back-to-top{opacity:1}}.back-to-top:hover{color:#87daff}.back-to-top.back-to-top-on{bottom:30px}.reading-progress-bar{--progress:0;z-index:50;height:3px;width:var(--progress);background:#37c6c0;position:fixed;top:0;left:0}.rtl.post-body p,.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ul,.rtl.post-body ol{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{text-align:center;margin-top:40px}.use-motion .post-block,.use-motion .pagination,.use-motion .comments,.use-motion .post-header,.use-motion .post-body,.use-motion .collection-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (width<=767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title:before{content:" ";background:#999;border:1px solid #fff;border-radius:50%;width:10px;height:10px;margin-top:-4px;margin-left:-6px;position:absolute;top:50%}.posts-collapse .post-content .collection-year{margin:60px 0;font-size:1.5em;font-weight:700;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{color:#555;text-shadow:none;background:#eee;border-radius:0;margin-left:.35em;padding:1px 4px;font-size:.75em;font-weight:700;line-height:1}.posts-collapse .post-content .collection-year:before{content:" ";background:#bbb;border-radius:50%;width:8px;height:8px;margin-top:-4px;margin-left:-4px;position:absolute;top:50%}.posts-collapse .post-content .collection-header{margin-left:20px;display:block}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;transition:border .2s ease-in-out;position:relative}.posts-collapse .post-content .post-header:before{content:" ";background:#bbb;border:1px solid #fff;border-radius:50%;width:6px;height:6px;transition:background .2s ease-in-out;position:absolute;top:.75em;left:-6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover:before{background:#222}.posts-collapse .post-content .post-meta-container{margin-right:10px;font-size:.75em;display:inline}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{color:var(--link-color);border-bottom:0}.posts-collapse .post-content .post-title .fa{margin-left:5px;font-size:.875em}.posts-collapse .post-content:before{content:" ";background:#f5f5f5;width:4px;height:100%;margin-left:-2px;position:absolute;top:1.25em}.post-body{overflow-wrap:break-word;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif}@media (width>=1200px){.post-body{font-size:1.125em}}@media (width>=992px){.post-body{text-align:justify}}@media (width<=991px){.post-body{text-align:justify}}.post-body h1 .header-anchor,.post-body h2 .header-anchor,.post-body h3 .header-anchor,.post-body h4 .header-anchor,.post-body h5 .header-anchor,.post-body h6 .header-anchor,.post-body h1 .headerlink,.post-body h2 .headerlink,.post-body h3 .headerlink,.post-body h4 .headerlink,.post-body h5 .headerlink,.post-body h6 .headerlink{color:inherit;float:right;opacity:0;border-bottom-style:none;margin-left:10px;font-size:.875em}.post-body h1 .header-anchor:before,.post-body h2 .header-anchor:before,.post-body h3 .header-anchor:before,.post-body h4 .header-anchor:before,.post-body h5 .header-anchor:before,.post-body h6 .header-anchor:before,.post-body h1 .headerlink:before,.post-body h2 .headerlink:before,.post-body h3 .headerlink:before,.post-body h4 .headerlink:before,.post-body h5 .headerlink:before,.post-body h6 .headerlink:before{content:"";font-family:"Font Awesome 6 Free";font-weight:900}.post-body h1:hover .header-anchor,.post-body h2:hover .header-anchor,.post-body h3:hover .header-anchor,.post-body h4:hover .header-anchor,.post-body h5:hover .header-anchor,.post-body h6:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .headerlink,.post-body h3:hover .headerlink,.post-body h4:hover .headerlink,.post-body h5:hover .headerlink,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h2:hover .header-anchor:hover,.post-body h3:hover .header-anchor:hover,.post-body h4:hover .header-anchor:hover,.post-body h5:hover .header-anchor:hover,.post-body h6:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{margin-left:4px;font-size:.875em}.post-body figure:not(.highlight) figcaption{color:#999;text-align:center;margin:-15px auto 15px;font-size:.875em;font-weight:700;line-height:1}.post-body iframe,.post-body img,.post-body video,.post-body embed{margin-bottom:20px}.post-body .video-container{width:100%;height:0;margin-bottom:20px;padding-top:75%;position:relative;overflow:hidden}.post-body .video-container iframe,.post-body .video-container object,.post-body .video-container embed{width:100%;height:100%;margin:0;position:absolute;top:0;left:0}.post-gallery{min-height:200px;display:flex}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{object-fit:cover;opacity:1;width:100%;height:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{text-align:center;margin-bottom:60px;font-size:1.125em}.posts-expand .post-title{margin:initial;overflow-wrap:break-word;font-size:1.5em;font-weight:400}.posts-expand .post-title-link{color:var(--link-color);border-bottom:0;max-width:100%;display:inline-block;position:relative}.posts-expand .post-title-link:before{background:var(--link-color);content:"";width:100%;height:2px;transition:transform .2s ease-in-out;position:absolute;bottom:0;left:0;transform:scaleX(0)}.posts-expand .post-title-link:hover:before{transform:scaleX(1)}.posts-expand .post-title-link .fa{margin-left:5px;font-size:.875em}.post-sticky-flag{margin-right:8px;display:inline-block;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;margin-top:3px;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:.75em}.posts-expand .post-meta-container .post-description{margin-top:2px;font-size:.875em}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{flex-wrap:wrap;justify-content:center;display:flex}:not(.post-meta-break)+.post-meta-item:before{content:"|";margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (width<=991px){.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}.post-nav{border-top:1px solid #eee;justify-content:space-between;gap:30px;margin-top:1em;padding:10px 5px 0;display:flex}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;font-size:.875em;line-height:1.6;display:block}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{flex-direction:column;justify-content:center;display:flex}.post-eof{background:#ccc;width:8%;height:1px;margin:80px auto 60px}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0;padding:.5em 1em;list-style:none;position:relative;overflow:hidden}.post-copyright ul:after{content:"";opacity:.1;font-family:"Font Awesome 6 Brands";font-size:200px;position:absolute;top:-150px;right:-50px}.post-tags{text-align:center;margin-top:40px}.post-tags a{font-size:.8125em;display:inline-block}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;flex-wrap:wrap;justify-content:center;margin-top:1em;padding-top:1em;font-size:.875em;display:flex}.social-like a{border-bottom:none}.reward-container{text-align:center;margin:1em 0 0;padding:1em 0}.reward-container button{color:#87daff;cursor:pointer;vertical-align:text-top;background:0 0;border:2px solid #87daff;border-radius:2px;outline:0;padding:0 15px;line-height:2}.reward-container button:hover{color:#fff;background:#87daff}.post-reward{padding-top:20px;display:none}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{width:180px;max-width:100%;margin:.8em 2em 0;display:inline-block}@keyframes next-roll{0%{transform:rotate(30deg)}to{transform:rotate(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{margin:0;padding:0;list-style:none}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{color:#555;text-shadow:none;background:#eee;border-radius:0;margin-left:.35em;padding:1px 4px;font-size:.75em;font-weight:700;line-height:1}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr:after{color:#fff;content:"NOW";background:#222;padding:0 5px;font-weight:700;display:inline-block}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{color:var(--event-title);border-bottom:0;margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary:before{background:var(--event-title);content:" ";border-radius:50%;width:12px;height:12px;margin-top:-6px;animation:1s ease-in-out infinite alternate dot-flash;position:absolute;top:50%;left:0}.event-list .event:nth-of-type(odd) .event-summary:before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);padding-left:12px;font-size:12px;font-weight:400;display:inline-block}.event-list .event .event-details{color:var(--event-foreground);padding:6px 0 6px 35px;line-height:18px;display:block}.event-list .event .event-details:before{color:var(--event-foreground);width:14px;margin-right:9px;font-family:"Font Awesome 6 Free";font-weight:900;display:inline-block}.event-list .event .event-details.event-location:before{content:""}.event-list .event .event-details.event-duration:before{content:""}.event-list .event .event-details.event-description:before{content:""}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{text-align:center;margin:1em 0;padding:0 2em;font-size:.75em;list-style:none}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child):before{content:"/ ";padding:.5em;font-weight:400}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{margin:10px;display:inline-block}.tag-cloud-0{color:#aaa;border-bottom-color:#aaa}.tag-cloud-1{color:#9a9a9a;border-bottom-color:#9a9a9a}.tag-cloud-2{color:#8b8b8b;border-bottom-color:#8b8b8b}.tag-cloud-3{color:#7c7c7c;border-bottom-color:#7c7c7c}.tag-cloud-4{color:#6c6c6c;border-bottom-color:#6c6c6c}.tag-cloud-5{color:#5d5d5d;border-bottom-color:#5d5d5d}.tag-cloud-6{color:#4e4e4e;border-bottom-color:#4e4e4e}.tag-cloud-7{color:#3e3e3e;border-bottom-color:#3e3e3e}.tag-cloud-8{color:#2f2f2f;border-bottom-color:#2f2f2f}.tag-cloud-9{color:#202020;border-bottom-color:#202020}.tag-cloud-10{color:#111;border-bottom-color:#111}.search-active{overflow:hidden}.search-pop-overlay{visibility:hidden;z-index:40;background:0 0;width:100%;height:100%;transition:visibility .4s,background .4s;display:flex;position:fixed;top:0;left:0}.search-active .search-pop-overlay{visibility:visible;background:#0000004d}.search-popup{background:var(--card-bg-color);border-radius:5px;width:700px;height:80%;margin:auto;transition:transform .4s;transform:scale(0)}.search-active .search-popup{transform:scale(1)}@media (width<=767px){.search-popup{border-radius:0;width:100%;height:100%}}.search-popup .search-icon,.search-popup .popup-btn-close{color:#999;padding:0 10px;font-size:18px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;padding:5px;display:flex}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{flex-direction:column;height:calc(100% - 55px);padding:5px 25px;display:flex;overflow:auto}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;margin:0 0 10px;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{color:#ff2a2a;background:0 0;border-bottom:1px dashed #ff2a2a;font-weight:700}.use-motion .animated{visibility:inherit;animation-fill-mode:none}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{width:700px;margin:0 auto}@media (width<=767px){header.header{width:auto}}@media (width>=1200px){header.header{width:800px}}@media (width>=1600px){header.header{width:900px}}.main-inner{width:700px;margin:0 auto;padding-bottom:60px}@media (width<=767px){.main-inner{width:auto}}@media (width>=1200px){.main-inner{width:800px}}@media (width>=1600px){.main-inner{width:900px}}@media (width<=767px){.main-inner{padding-left:20px;padding-right:20px}}.post-block:first-of-type{padding-top:70px}@media (width<=767px){.post-block:first-of-type{padding-top:35px}}.custom-logo-image{background:#fff;max-width:150px;margin:0 auto 10px;padding:5px}.brand{background:var(--btn-default-bg)}header.header{padding-top:100px}@media (width<=767px){header.header{padding-top:50px}.site-nav{padding-top:30px}.main-menu{border-top:1px solid #ddd;border-bottom:1px solid #ddd}.menu{text-align:left}.menu .menu-item{margin:0 10px}}.menu .menu-item a{border-bottom:1px solid #0000}@media (width<=767px){.menu .menu-item a{align-items:center;padding:5px 10px;display:flex}.menu .menu-item a .badge{margin-left:auto}}.menu .menu-item a:hover,.menu .menu-item a.menu-item-active{border-bottom:1px solid var(--link-hover-color);background:0 0}@media (width<=767px){.menu .menu-item a:hover,.menu .menu-item a.menu-item-active{border-bottom:1px dotted #ddd}}@media (width>=768px){.menu .menu-item i[class^=fa]{width:100%;margin-right:0;line-height:2;display:block}}.sub-menu{margin:10px 0}.sub-menu .menu-item{display:inline-block}@media (width>=1200px){.sidebar-dimmer{display:none}.sidebar-active{padding-right:320px}.sidebar-active .footer-fixed{right:320px}}</style><link integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css rel=stylesheet><link integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"wangfanggang.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script defer src=/js/config.js></script><meta content=blog property=og:type><meta content=IT知识点整理 property=og:title><meta content=https://wangfanggang.com/IT/it_study/index.html property=og:url><meta content=钢钢更新 property=og:site_name><meta content=zh_CN property=og:locale><meta content="https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224120347.png?x-oss-process=image/format,jpg/quality,q_40" property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224101022.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224094153.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224095028.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224100058.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224105720.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224113405.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224094456.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224145141.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224143946.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224144020.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224144053.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224144125.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224091804.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224091616.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224091104.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225103853.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023093735.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023094032.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225081336.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225081520.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225081829.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225082120.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225083102.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224133520.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224133639.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224134238.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224084745.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224085014.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223203331.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223205013.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223213150.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223180505.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223180656.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223180906.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224150421.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224150814.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152933.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224151633.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152514.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152538.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152606.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023095848.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023133305.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023100350.png property=og:image><meta content=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023100603.png property=og:image><meta content=2019-12-24T12:00:00.000Z property=article:published_time><meta content=2019-12-31T01:38:42.000Z property=article:modified_time><meta content="王方钢 / Kenny Wang" property=article:author><meta content=Cloud property=article:tag><meta content=Architecture property=article:tag><meta content=IT property=article:tag><meta content=Solution property=article:tag><meta content=summary name=twitter:card><meta content="https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224120347.png?x-oss-process=image/format,jpg/quality,q_40" name=twitter:image><link href=https://wangfanggang.com/IT/it_study/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wangfanggang.com/IT/it_study/","path":"IT/it_study/","title":"IT知识点整理"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>IT知识点整理 | 钢钢更新</title><script integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script defer src=/js/utils.js></script><script defer src=/js/motion.js></script><script defer src=/js/sidebar.js></script><script defer src=/js/next-boot.js></script><script integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script defer src=/js/third-party/search/local-search.js></script><script defer src=/js/third-party/addtoany.js></script><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>钢钢更新</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>用行动改变世界，做个有情怀的技术宅</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-sitemap"><a href=/sitemap.xml rel=section><i class="fa fa-sitemap fa-fw"></i>站点地图</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.</span> <span class=nav-text>虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.1.</span> <span class=nav-text>服务器虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#x86-CPU%E6%9E%B6%E6%9E%84><span class=nav-number>1.1.1.</span> <span class=nav-text>x86 CPU架构</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#Ring3-%E7%94%A8%E6%88%B7%E6%80%81-User-Mode><span class=nav-number>1.1.1.1.</span> <span class=nav-text>Ring3 用户态 (User Mode)</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Ring0-%E6%A0%B8%E5%BF%83%E6%80%81-Kernel-Mode><span class=nav-number>1.1.1.2.</span> <span class=nav-text>Ring0 核心态 (Kernel Mode)</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%85%A8%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.1.2.</span> <span class=nav-text>全虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E8%BD%AF%E4%BB%B6%E8%BE%85%E5%8A%A9%E7%9A%84%E5%85%A8%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.1.2.1.</span> <span class=nav-text>软件辅助的全虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-6"><a class=nav-link href=#QEMU><span class=nav-number>1.1.2.1.1.</span> <span class=nav-text>QEMU</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#VMware-Workstation><span class=nav-number>1.1.2.1.2.</span> <span class=nav-text>VMware Workstation</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#Oracle-Virtualbox><span class=nav-number>1.1.2.1.3.</span> <span class=nav-text>Oracle Virtualbox</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#Parallels-Desktop><span class=nav-number>1.1.2.1.4.</span> <span class=nav-text>Parallels Desktop</span></a></ol><li class="nav-item nav-level-5"><a class=nav-link href=#%E7%A1%AC%E4%BB%B6%E8%BE%85%E5%8A%A9%E7%9A%84%E5%85%A8%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.1.2.2.</span> <span class=nav-text>硬件辅助的全虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-6"><a class=nav-link href=#KVM><span class=nav-number>1.1.2.2.1.</span> <span class=nav-text>KVM</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#VMware-ESXi><span class=nav-number>1.1.2.2.2.</span> <span class=nav-text>VMware ESXi</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#Microsoft-Hyper-V><span class=nav-number>1.1.2.2.3.</span> <span class=nav-text>Microsoft Hyper-V</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#Xen-HVM><span class=nav-number>1.1.2.2.4.</span> <span class=nav-text>Xen (HVM)</span></a></ol></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%8D%8A%E8%99%9A%E6%8B%9F%E5%8C%96-%E5%87%86%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.1.3.</span> <span class=nav-text>半虚拟化 (准虚拟化)</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#Xen><span class=nav-number>1.1.3.1.</span> <span class=nav-text>Xen</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E6%80%BB%E7%BB%93><span class=nav-number>1.1.4.</span> <span class=nav-text>服务器虚拟化总结</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%86%85%E5%AD%98%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.2.</span> <span class=nav-text>内存虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%BD%AF%E4%BB%B6%E7%BA%A7%E5%86%85%E5%AD%98%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.2.1.</span> <span class=nav-text>软件级内存虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98><span class=nav-number>1.2.1.1.</span> <span class=nav-text>虚拟内存</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%A1%AC%E4%BB%B6%E7%A1%AC%E4%BB%B6%E7%BA%A7%E5%86%85%E5%AD%98%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.2.2.</span> <span class=nav-text>硬件硬件级内存虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#Intel-EPT-Extended-Page-Table><span class=nav-number>1.2.2.1.</span> <span class=nav-text>Intel EPT (Extended Page Table)</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#AMD-NTP-Nested-Page-Table><span class=nav-number>1.2.2.2.</span> <span class=nav-text>AMD NTP (Nested Page Table)</span></a></ol></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AD%98%E5%82%A8%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.3.</span> <span class=nav-text>存储虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#LVM><span class=nav-number>1.3.1.</span> <span class=nav-text>LVM</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#LVM%E5%9F%BA%E6%9C%AC%E6%9C%AF%E8%AF%AD><span class=nav-number>1.3.1.1.</span> <span class=nav-text>LVM基本术语</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#RAID-%E6%8A%80%E6%9C%AF><span class=nav-number>1.3.2.</span> <span class=nav-text>RAID 技术</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%BD%91%E7%BB%9C%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.4.</span> <span class=nav-text>网络虚拟化</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%98%BE%E5%8D%A1%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.5.</span> <span class=nav-text>显卡虚拟化</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%A1%8C%E9%9D%A2%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.6.</span> <span class=nav-text>桌面虚拟化</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AE%B9%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96><span class=nav-number>1.7.</span> <span class=nav-text>容器虚拟化</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#LXC><span class=nav-number>1.7.1.</span> <span class=nav-text>LXC</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#libcontainer><span class=nav-number>1.7.2.</span> <span class=nav-text>libcontainer</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#runC><span class=nav-number>1.7.3.</span> <span class=nav-text>runC</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#openvz><span class=nav-number>1.7.4.</span> <span class=nav-text>openvz</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BA%91%E7%AE%A1%E5%B9%B3%E5%8F%B0><span class=nav-number>1.8.</span> <span class=nav-text>云管平台</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#OpenStack><span class=nav-number>1.8.1.</span> <span class=nav-text>OpenStack</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#VMware-vSphere><span class=nav-number>1.8.2.</span> <span class=nav-text>VMware vSphere</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84><span class=nav-number>2.</span> <span class=nav-text>分布式系统架构</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA><span class=nav-number>2.1.</span> <span class=nav-text>分布式理论</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#CAP%E7%90%86%E8%AE%BA><span class=nav-number>2.1.1.</span> <span class=nav-text>CAP理论</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#BASE%E7%90%86%E8%AE%BA><span class=nav-number>2.1.2.</span> <span class=nav-text>BASE理论</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#CAP-BASE-ACID%E7%9A%84%E5%85%B3%E7%B3%BB><span class=nav-number>2.1.3.</span> <span class=nav-text>CAP, BASE, ACID的关系</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%B9%82%E7%AD%89%E6%80%A7><span class=nav-number>2.2.</span> <span class=nav-text>幂等性</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%A7%A3%E5%86%B3%E5%B9%82%E7%AD%89%E7%9A%84%E6%96%B9%E6%B3%95><span class=nav-number>2.2.1.</span> <span class=nav-text>解决幂等的方法</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E9%80%89%E5%9E%8B><span class=nav-number>3.</span> <span class=nav-text>微服务框架选型</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#RESTful%E6%A1%86%E6%9E%B6><span class=nav-number>3.1.</span> <span class=nav-text>RESTful框架</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Spring-Cloud><span class=nav-number>3.1.1.</span> <span class=nav-text>Spring Cloud</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#RPC%E6%A1%86%E6%9E%B6><span class=nav-number>3.2.</span> <span class=nav-text>RPC框架</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Thrift><span class=nav-number>3.2.1.</span> <span class=nav-text>Thrift</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#gRPC><span class=nav-number>3.2.2.</span> <span class=nav-text>gRPC</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Dubbo><span class=nav-number>3.2.3.</span> <span class=nav-text>Dubbo</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Dubbox><span class=nav-number>3.2.4.</span> <span class=nav-text>Dubbox</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%96%B0%E9%94%90%E6%A1%86%E6%9E%B6><span class=nav-number>3.3.</span> <span class=nav-text>新锐框架</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Istio><span class=nav-number>3.3.1.</span> <span class=nav-text>Istio</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97MQ><span class=nav-number>4.</span> <span class=nav-text>消息队列MQ</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Kafka><span class=nav-number>4.1.</span> <span class=nav-text>Kafka</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#RabbitMQ><span class=nav-number>4.2.</span> <span class=nav-text>RabbitMQ</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#RocketMQ><span class=nav-number>4.3.</span> <span class=nav-text>RocketMQ</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Stream><span class=nav-number>4.4.</span> <span class=nav-text>Spring Cloud Stream</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93><span class=nav-number>5.</span> <span class=nav-text>数据库</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#RDBMS-vs-NoSQL><span class=nav-number>5.1.</span> <span class=nav-text>RDBMS vs NoSQL</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BA%8B%E5%8A%A1><span class=nav-number>5.2.</span> <span class=nav-text>事务</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A6%81%E7%B4%A0%EF%BC%88ACID%EF%BC%89><span class=nav-number>5.2.1.</span> <span class=nav-text>事务的基本要素（ACID）</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98><span class=nav-number>5.2.2.</span> <span class=nav-text>事务的并发问题</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E8%84%8F%E8%AF%BB><span class=nav-number>5.2.2.1.</span> <span class=nav-text>脏读</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB><span class=nav-number>5.2.2.2.</span> <span class=nav-text>不可重复读</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%B9%BB%E8%AF%BB><span class=nav-number>5.2.2.3.</span> <span class=nav-text>幻读</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%EF%BC%882PC%EF%BC%89><span class=nav-number>5.2.3.</span> <span class=nav-text>二阶段提交（2PC）</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5><span class=nav-number>5.2.3.1.</span> <span class=nav-text>第一阶段</span></a><ol class=nav-child><li class="nav-item nav-level-6"><a class=nav-link href=#%E6%AD%A3%E5%B8%B8%E6%83%85%E5%86%B5><span class=nav-number>5.2.3.1.1.</span> <span class=nav-text>正常情况</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#%E5%87%BA%E9%94%99%E6%97%B6><span class=nav-number>5.2.3.1.2.</span> <span class=nav-text>出错时</span></a><li class="nav-item nav-level-6"><a class=nav-link href=#%E4%B8%AD%E6%96%AD%E4%BA%8B%E5%8A%A1><span class=nav-number>5.2.3.1.3.</span> <span class=nav-text>中断事务</span></a></ol><li class="nav-item nav-level-5"><a class=nav-link href=#%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5><span class=nav-number>5.2.3.2.</span> <span class=nav-text>第二阶段</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%B8%89%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%EF%BC%883PC%EF%BC%89><span class=nav-number>5.2.4.</span> <span class=nav-text>三阶段提交（3PC）</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#CanCommit%E9%98%B6%E6%AE%B5><span class=nav-number>5.2.4.1.</span> <span class=nav-text>CanCommit阶段</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#PreCommit%E9%98%B6%E6%AE%B5><span class=nav-number>5.2.4.2.</span> <span class=nav-text>PreCommit阶段</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#doCommit%E9%98%B6%E6%AE%B5><span class=nav-number>5.2.4.3.</span> <span class=nav-text>doCommit阶段</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#2PC%E4%B8%8E3PC%E7%9A%84%E5%8C%BA%E5%88%AB><span class=nav-number>5.2.5.</span> <span class=nav-text>2PC与3PC的区别</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#MySQL><span class=nav-number>5.3.</span> <span class=nav-text>MySQL</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#MySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB><span class=nav-number>5.3.1.</span> <span class=nav-text>MySQL事务隔离级别</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#MyISAM%E4%B8%8EInnoDB%E7%9A%84%E5%8C%BA%E5%88%AB><span class=nav-number>5.3.2.</span> <span class=nav-text>MyISAM与InnoDB的区别</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#InnoDB%E9%94%81%E6%9C%BA%E5%88%B6><span class=nav-number>5.3.3.</span> <span class=nav-text>InnoDB锁机制</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#InnoDB%E6%97%A5%E5%BF%97><span class=nav-number>5.3.4.</span> <span class=nav-text>InnoDB日志</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E6%97%A5%E5%BF%97%E7%A7%8D%E7%B1%BB><span class=nav-number>5.3.4.1.</span> <span class=nav-text>日志种类</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#binlog%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F><span class=nav-number>5.3.4.2.</span> <span class=nav-text>binlog日志格式</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%A4%87%E4%BB%BD><span class=nav-number>5.3.5.</span> <span class=nav-text>备份</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#mysqldump><span class=nav-number>5.3.5.1.</span> <span class=nav-text>mysqldump</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#xtranbackup><span class=nav-number>5.3.5.2.</span> <span class=nav-text>xtranbackup</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%85%A2%E6%9F%A5%E8%AF%A2><span class=nav-number>5.3.6.</span> <span class=nav-text>慢查询</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%88%86%E5%8C%BA%E8%A1%A8><span class=nav-number>5.3.7.</span> <span class=nav-text>分区表</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8><span class=nav-number>5.3.8.</span> <span class=nav-text>分库分表</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6><span class=nav-number>5.3.9.</span> <span class=nav-text>MySQL主从复制</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#Oracle><span class=nav-number>5.4.</span> <span class=nav-text>Oracle</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#SQL-Server><span class=nav-number>5.5.</span> <span class=nav-text>SQL Server</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Redis><span class=nav-number>5.6.</span> <span class=nav-text>Redis</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B><span class=nav-number>5.6.1.</span> <span class=nav-text>支持的数据类型</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Redis%E6%8C%81%E4%B9%85%E5%8C%96><span class=nav-number>5.6.2.</span> <span class=nav-text>Redis持久化</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#RDB-%E5%85%A8%E9%87%8F%E6%8C%81%E4%B9%85%E5%8C%96><span class=nav-number>5.6.2.1.</span> <span class=nav-text>RDB (全量持久化)</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#AOF-%E5%A2%9E%E9%87%8F%E6%8C%81%E4%B9%85%E5%8C%96><span class=nav-number>5.6.2.2.</span> <span class=nav-text>AOF (增量持久化)</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#Redis%E9%9B%86%E7%BE%A4><span class=nav-number>5.6.3.</span> <span class=nav-text>Redis集群</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6><span class=nav-number>5.6.3.1.</span> <span class=nav-text>主从复制</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Redis-Sentinal%EF%BC%88%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%EF%BC%89><span class=nav-number>5.6.3.2.</span> <span class=nav-text>Redis Sentinal（哨兵模式）</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Redis-Cluster><span class=nav-number>5.6.3.3.</span> <span class=nav-text>Redis Cluster</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%B8%80%E8%87%B4%E6%80%A7hash><span class=nav-number>5.6.4.</span> <span class=nav-text>一致性hash</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9><span class=nav-number>5.6.4.1.</span> <span class=nav-text>虚拟节点</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5><span class=nav-number>5.6.5.</span> <span class=nav-text>淘汰策略</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#Memcache><span class=nav-number>5.7.</span> <span class=nav-text>Memcache</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Memcache-%E7%89%B9%E7%82%B9><span class=nav-number>5.7.1.</span> <span class=nav-text>Memcache 特点</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Memcache-%E7%BC%BA%E7%82%B9><span class=nav-number>5.7.2.</span> <span class=nav-text>Memcache 缺点</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#MongoDB><span class=nav-number>5.8.</span> <span class=nav-text>MongoDB</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%BC%93%E5%AD%98%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98><span class=nav-number>5.9.</span> <span class=nav-text>缓存常见问题</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9><span class=nav-number>5.9.1.</span> <span class=nav-text>缓存雪崩</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F><span class=nav-number>5.9.2.</span> <span class=nav-text>缓存穿透</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF><span class=nav-number>5.9.3.</span> <span class=nav-text>缓存击穿</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81><span class=nav-number>5.10.</span> <span class=nav-text>分布式锁</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81><span class=nav-number>5.10.1.</span> <span class=nav-text>Redis分布式锁</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#Redis%E9%9B%86%E7%BE%A4%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%EF%BC%88RedLock%EF%BC%89><span class=nav-number>5.10.1.1.</span> <span class=nav-text>Redis集群分布式锁（RedLock）</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81><span class=nav-number>5.10.2.</span> <span class=nav-text>数据库分布式锁</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8><span class=nav-number>5.10.2.1.</span> <span class=nav-text>基于数据库表</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8E%92%E4%BB%96%E9%94%81><span class=nav-number>5.10.2.2.</span> <span class=nav-text>基于数据库排他锁</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#Zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81><span class=nav-number>5.10.3.</span> <span class=nav-text>Zookeeper分布式锁</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C-%E5%8F%91%E7%8E%B0><span class=nav-number>6.</span> <span class=nav-text>服务注册/发现</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Zookeeper><span class=nav-number>6.1.</span> <span class=nav-text>Zookeeper</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Etcd><span class=nav-number>6.2.</span> <span class=nav-text>Etcd</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Consul><span class=nav-number>6.3.</span> <span class=nav-text>Consul</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Euraka><span class=nav-number>6.4.</span> <span class=nav-text>Euraka</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#API-Gateway-%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3><span class=nav-number>7.</span> <span class=nav-text>API Gateway (服务网关)</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Zuul><span class=nav-number>7.1.</span> <span class=nav-text>Zuul</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Gateway><span class=nav-number>7.2.</span> <span class=nav-text>Spring Cloud Gateway</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Kong><span class=nav-number>7.3.</span> <span class=nav-text>Kong</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1><span class=nav-number>8.</span> <span class=nav-text>负载均衡</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Nginx-7%E5%B1%82><span class=nav-number>8.1.</span> <span class=nav-text>Nginx (7层)</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5><span class=nav-number>8.1.1.</span> <span class=nav-text>Nginx负载均衡策略</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#Haproxy-7%E5%B1%82><span class=nav-number>8.2.</span> <span class=nav-text>Haproxy (7层)</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#LVS-4%E5%B1%82><span class=nav-number>8.3.</span> <span class=nav-text>LVS (4层)</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#3%E7%A7%8D%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A8%A1%E5%9E%8B><span class=nav-number>8.3.1.</span> <span class=nav-text>3种负载均衡模型</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#NAT%E6%A8%A1%E5%9E%8B><span class=nav-number>8.3.1.1.</span> <span class=nav-text>NAT模型</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#DR%E6%A8%A1%E5%9E%8B-Direct-Route><span class=nav-number>8.3.1.2.</span> <span class=nav-text>DR模型 (Direct Route)</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#TUN%E6%A8%A1%E5%9E%8B><span class=nav-number>8.3.1.3.</span> <span class=nav-text>TUN模型</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#LVS%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95><span class=nav-number>8.3.2.</span> <span class=nav-text>LVS负载均衡调度算法</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#LVS-Keepalived><span class=nav-number>8.3.3.</span> <span class=nav-text>LVS + Keepalived</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%A1%AC%E4%BB%B6F5-A10><span class=nav-number>8.4.</span> <span class=nav-text>硬件F5, A10</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Ribbon><span class=nav-number>8.5.</span> <span class=nav-text>Spring Cloud Ribbon</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%86%94%E6%96%AD%E5%99%A8><span class=nav-number>9.</span> <span class=nav-text>熔断器</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%B8%B8%E8%A7%81%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95><span class=nav-number>9.1.</span> <span class=nav-text>常见限流算法</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%BC%8F%E6%96%97><span class=nav-number>9.1.1.</span> <span class=nav-text>漏斗</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%BB%A4%E7%89%8C%E6%A1%B6><span class=nav-number>9.1.2.</span> <span class=nav-text>令牌桶</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E9%98%9F%E5%88%97><span class=nav-number>9.1.3.</span> <span class=nav-text>队列</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%AE%A1%E6%95%B0%E5%99%A8><span class=nav-number>9.1.4.</span> <span class=nav-text>计数器</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%8A%A8%E6%80%81%E6%B5%81%E6%8E%A7><span class=nav-number>9.1.5.</span> <span class=nav-text>动态流控</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#Hystrix><span class=nav-number>9.2.</span> <span class=nav-text>Hystrix</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E9%9A%94%E7%A6%BB%E6%A8%A1%E5%BC%8F><span class=nav-number>9.2.1.</span> <span class=nav-text>隔离模式</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E9%9A%94%E7%A6%BB%E6%A8%A1%E5%BC%8F><span class=nav-number>9.2.1.1.</span> <span class=nav-text>线程池隔离模式</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%BF%A1%E5%8F%B7%E9%87%8F%E9%9A%94%E7%A6%BB%E6%A8%A1%E5%BC%8F><span class=nav-number>9.2.1.2.</span> <span class=nav-text>信号量隔离模式</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E9%99%8D%E7%BA%A7><span class=nav-number>9.2.2.</span> <span class=nav-text>降级</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%BF%AB%E9%80%9F%E6%A8%A1%E5%BC%8F><span class=nav-number>9.2.2.1.</span> <span class=nav-text>快速模式</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB><span class=nav-number>9.2.2.2.</span> <span class=nav-text>故障转移</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%B8%BB%E6%AC%A1%E6%A8%A1%E5%BC%8F><span class=nav-number>9.2.2.3.</span> <span class=nav-text>主次模式</span></a></ol></ol><li class="nav-item nav-level-3"><a class=nav-link href=#Sentinel><span class=nav-number>9.3.</span> <span class=nav-text>Sentinel</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Resilience4j><span class=nav-number>9.4.</span> <span class=nav-text>Resilience4j</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86><span class=nav-number>10.</span> <span class=nav-text>配置管理</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Config><span class=nav-number>10.1.</span> <span class=nav-text>Spring Cloud Config</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Disconf><span class=nav-number>10.2.</span> <span class=nav-text>Disconf</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Apollo><span class=nav-number>10.3.</span> <span class=nav-text>Apollo</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Nacos><span class=nav-number>10.4.</span> <span class=nav-text>Nacos</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%B0%83%E7%94%A8%E9%93%BE%E7%9B%91%E6%8E%A7%EF%BC%88APM%EF%BC%89><span class=nav-number>11.</span> <span class=nav-text>调用链监控（APM）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Zipkin><span class=nav-number>11.1.</span> <span class=nav-text>Zipkin</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#CAT><span class=nav-number>11.2.</span> <span class=nav-text>CAT</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Pinpoint><span class=nav-number>11.3.</span> <span class=nav-text>Pinpoint</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Sleuth><span class=nav-number>11.4.</span> <span class=nav-text>Spring Cloud Sleuth</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Skywalking><span class=nav-number>11.5.</span> <span class=nav-text>Skywalking</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%97%A5%E5%BF%97-%E7%9B%91%E6%8E%A7><span class=nav-number>12.</span> <span class=nav-text>日志/监控</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#ELK-Elasticsearch-Logstash-Kibina><span class=nav-number>12.1.</span> <span class=nav-text>ELK (Elasticsearch + Logstash + Kibina)</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Prometheus-Grafana><span class=nav-number>12.2.</span> <span class=nav-text>Prometheus + Grafana</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Zabbix><span class=nav-number>12.3.</span> <span class=nav-text>Zabbix</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Nagios><span class=nav-number>12.4.</span> <span class=nav-text>Nagios</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Sleuth-slu%CE%B8-%EF%BC%9A><span class=nav-number>12.5.</span> <span class=nav-text>Spring Cloud Sleuth [sluθ]：</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%AE%89%E5%85%A8><span class=nav-number>13.</span> <span class=nav-text>安全</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#OAuth2><span class=nav-number>13.1.</span> <span class=nav-text>OAuth2</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#JWT><span class=nav-number>13.2.</span> <span class=nav-text>JWT</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%B9%B3%E5%8F%B0><span class=nav-number>14.</span> <span class=nav-text>服务部署平台</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E7%B3%BB%E7%BB%9F><span class=nav-number>14.1.</span> <span class=nav-text>集群资源调度系统</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Kubernetes-k8s><span class=nav-number>14.1.1.</span> <span class=nav-text>Kubernetes (k8s)</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Mesos><span class=nav-number>14.1.2.</span> <span class=nav-text>Mesos</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Docker-Swarm><span class=nav-number>14.1.3.</span> <span class=nav-text>Docker Swarm</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6><span class=nav-number>14.2.</span> <span class=nav-text>版本控制</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Github><span class=nav-number>14.2.1.</span> <span class=nav-text>Github</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Gitlab><span class=nav-number>14.2.2.</span> <span class=nav-text>Gitlab</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AE%B9%E5%99%A8%E5%B9%B3%E5%8F%B0><span class=nav-number>14.3.</span> <span class=nav-text>容器平台</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Docker><span class=nav-number>14.3.1.</span> <span class=nav-text>Docker</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#AWS><span class=nav-number>14.3.2.</span> <span class=nav-text>AWS</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E9%98%BF%E9%87%8C%E4%BA%91><span class=nav-number>14.3.3.</span> <span class=nav-text>阿里云</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Google-Cloud><span class=nav-number>14.3.4.</span> <span class=nav-text>Google Cloud</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%95%9C%E5%83%8F%E6%B2%BB%E7%90%86><span class=nav-number>14.4.</span> <span class=nav-text>镜像治理</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Harbor><span class=nav-number>14.4.1.</span> <span class=nav-text>Harbor</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86-1><span class=nav-number>14.5.</span> <span class=nav-text>配置管理</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Chef><span class=nav-number>14.5.1.</span> <span class=nav-text>Chef</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Puppet><span class=nav-number>14.5.2.</span> <span class=nav-text>Puppet</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Ansible><span class=nav-number>14.5.3.</span> <span class=nav-text>Ansible</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%EF%BC%88CI%EF%BC%89><span class=nav-number>14.6.</span> <span class=nav-text>持续集成（CI）</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Jenkins><span class=nav-number>14.6.1.</span> <span class=nav-text>Jenkins</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Travis-CI><span class=nav-number>14.6.2.</span> <span class=nav-text>Travis CI</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8C%81%E7%BB%AD%E5%8F%91%E5%B8%83%EF%BC%88CD%EF%BC%89><span class=nav-number>14.7.</span> <span class=nav-text>持续发布（CD）</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Harbor-1><span class=nav-number>14.7.1.</span> <span class=nav-text>Harbor</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%AB%98%E5%8F%AF%E7%94%A8%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81><span class=nav-number>15.</span> <span class=nav-text>高可用分布式锁</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AD%98%E5%82%A8%E5%B1%82%E4%BA%A7%E5%93%81><span class=nav-number>15.1.</span> <span class=nav-text>存储层产品</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Redis-1><span class=nav-number>15.1.1.</span> <span class=nav-text>Redis</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Zookeeper-1><span class=nav-number>15.1.2.</span> <span class=nav-text>Zookeeper</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#Etcd-1><span class=nav-number>15.1.3.</span> <span class=nav-text>Etcd</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7><span class=nav-number>16.</span> <span class=nav-text>压测工具</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#JMeter><span class=nav-number>16.1.</span> <span class=nav-text>JMeter</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#TCPCopy><span class=nav-number>16.2.</span> <span class=nav-text>TCPCopy</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Apache-ab><span class=nav-number>16.3.</span> <span class=nav-text>Apache ab</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#IM><span class=nav-number>17.</span> <span class=nav-text>IM</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Slack><span class=nav-number>17.1.</span> <span class=nav-text>Slack</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%92%89%E9%92%89><span class=nav-number>17.2.</span> <span class=nav-text>钉钉</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt="王方钢 / Kenny Wang" class=site-author-image itemprop=image src=/uploads/kwang.jpg><p class=site-author-name itemprop=name>王方钢 / Kenny Wang<div class=site-description itemprop=description></div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>176</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>19</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>61</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/wfg2513148" href=https://github.com/wfg2513148 target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a rel="noopener me" title="E-Mail → mailto:wfgdlut@gmail.com" href=mailto:wfgdlut@gmail.com target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class=links-of-author-item> <a rel="noopener me" title="Twitter → https://x.com/wfgdlut" href=https://x.com/wfgdlut target=_blank><i class="fab fa-twitter fa-fw"></i>Twitter</a> </span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://wangfanggang.com/IT/it_study/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/uploads/kwang.jpg itemprop=image> <meta content="王方钢 / Kenny Wang" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=钢钢更新 itemprop=name> <meta itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="IT知识点整理 | 钢钢更新" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>IT知识点整理</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2019-12-24 12:00:00" datetime=2019-12-24T12:00:00+00:00>2019-12-24</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2019-12-31 01:38:42" datetime=2019-12-31T01:38:42+00:00 itemprop=dateModified>2019-12-31</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/IT/ itemprop=url rel=index><span itemprop=name>IT</span></a> </span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>21k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>1:15</span> </span></div></div></header><div class=post-body itemprop=articleBody><p><img src="https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224120347.png?x-oss-process=image/format,jpg/quality,q_40"></p><span id=more></span><h2 id=虚拟化><a class=headerlink href=#虚拟化 title=虚拟化></a>虚拟化</h2><h3 id=服务器虚拟化><a class=headerlink href=#服务器虚拟化 title=服务器虚拟化></a>服务器虚拟化</h3><h4 id=x86-CPU架构><a title="x86 CPU架构" class=headerlink href=#x86-CPU架构></a>x86 CPU架构</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224101022.png><h5 id=Ring3-用户态-User-Mode><a title="Ring3 用户态 (User Mode)" class=headerlink href=#Ring3-用户态-User-Mode></a>Ring3 用户态 (User Mode)</h5><p><code>Ring3 用户态 (User Mode)</code>：运行在用户态的程序代码需要受到CPU的检查，用户态程序代码只能访问内存页表项中规定能被用户态程序代码访问的页面虚拟地址(受限的内存访问)，而且还只能访问 TSS中的I/O Permission Bitmap 中规定能被用户态程序代码访问的端口。甚至不能直接访问外围硬件设备、不能抢占CPU。所有的应用程序(Application)都运行在用户态上。——当运行在用户态的Application需要调用只能被核心态代码直接访问的硬件设备时，CPU会通过特别的接口去调用核心态的代码，以此来实现Application对硬件设备的调用。如果用户态的Application直接调用硬件设备时，就会被Host OS捕捉到并触发异常。<h5 id=Ring0-核心态-Kernel-Mode><a title="Ring0 核心态 (Kernel Mode)" class=headerlink href=#Ring0-核心态-Kernel-Mode></a>Ring0 核心态 (Kernel Mode)</h5><p><code>Ring0 核心态 (Kernel Mode)</code>：是HostOS Kernel运行的模式。运行在核心态的代码可以无限制的对系统内存、设备驱动程序、网卡接口、显卡接口等外围硬件设备进行访问。只有 HostOS 能够无限制的访问磁盘、键盘等外围硬件设备的数据，但是首先需要在 HostOS 上安装驱动程序。<p><strong>CPU虚拟化技术</strong>：<ul><li>Intel VT-X<li>AMD-V</ul><h4 id=全虚拟化><a class=headerlink href=#全虚拟化 title=全虚拟化></a>全虚拟化</h4><p>不需要对GuestOS操作系统软件的源代码做任何的修改，就可以运行在VMM中。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224094153.png><p>在全虚拟化的虚拟平台中，GuestOS 并不知道自己是一台虚拟机，它会认为自己就是运行在计算机物理硬件设备上的 HostOS。因为全虚拟化的 VMM 会将一个OS所能够操作的CPU、内存、外设等物理设备逻辑抽象成为虚拟CPU、虚拟内存、虚拟外设等虚拟设备后，再交由 GuestOS 来操作使用。这样的 GuestOS 会将底层硬件平台视为自己所有的，但是实际上，这些都是VMM为 GuestOS 制造了这种假象。<p><code>优点</code>: GuestOS没有经过任何修改；<br><code>缺点</code>: 需要底层硬件支持，比如: PowerPC；<p><code>典型代表</code>:<ul><li>VMware Workstation<li>Oracle Virtualbox<li>Parallels Desktop<li>Microsoft Hyper-V<li>KVM<li>XEN (HVM)</ul><h5 id=软件辅助的全虚拟化><a class=headerlink href=#软件辅助的全虚拟化 title=软件辅助的全虚拟化></a>软件辅助的全虚拟化</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224095028.png><p>在Intel等CPU厂商还没有发布 x86 CPU虚拟化技术之前，完全虚拟化都是通过软件辅助的方式来实现的。软件辅助的全虚拟化主要是应用了两种机制:<ol><li><strong>特权解除</strong>：从上述的软件辅助全虚拟化架构图中可以看出，VMM、GuestOS、Guest Applications 都是运行在 Ring 1-3 用户态。当在 GuestOS 中执行系统内核的特权指令时，一般都会触发异常。这是因为用户态代码不能直接运行在核心态中，而且系统内核的特权指令大多都只能运行在 Ring 0 核心态中。在触发了异常之后，这些异常就会被 VMM 捕获，再由 VMM 将这些特权指令进行虚拟化成为只针对虚拟CPU起作用的虚拟特权指令。其本质就是使用若干能运行在用户态中的非特权指令来模拟出只针对GuestOS有效的虚拟特权指令，从而将特权指令的特权解除掉。</ol><blockquote><p><code>缺点</code>：特权解除的问题在于当初设计标准x86架构CPU时，并没有考虑到要支持虚拟化技术，所以会存在一部分特权指令运行在 Ring 1 用户态上 (19个特权指令)，而这些运行在 Ring 1 上的特权指令并不会触发异常然后再被VMM捕获，从而导致在GuestOS中执行的特权指令直接对HostOS造成了影响(GuestOS 和 HostOS 没能做到完全隔离)。针对这个问题，再引入了陷入模拟的机制。</blockquote><ol start=2><li><strong>陷入模拟</strong>：就是 VMM 会对 GuestOS 中的二进制代码 (运行在CPU中的代码) 进行扫描，一旦发现 GuestOS 执行的二进制代码中包含有运行在用户态上的特权指令二进制代码时，就会将这些二进制代码翻译成虚拟特权指令二进制代码或运行在核心态中的特权指令二进制代码，从而强制触发异常。这样就能够很好的解决了运行在 Ring 1 用户态上的特权指令没有被VMM捕获的问题，更好的实现了 GuestOS 和 HostOS 的隔离。</ol><p>后来CPU厂商们发布了能够判断特权指令归属的标准x86 CPU之后，迎来了硬件辅助全虚拟化。<h6 id=QEMU><a class=headerlink href=#QEMU title=QEMU></a>QEMU</h6><p><code>QEMU</code> 是一个独立的虚拟化解决方案，通过 Intel-VT 或 AMD SVM 实现全虚拟化，安装qemu的系统，可以直接模拟出另一个完全不同的系统环境，虚拟机的创建通过 qemu-image 既可完成。QEMU 本身可以不依赖于KVM，但是如果有KVM的存在并且硬件(处理器)支持比如 Intel-VT 功能，那么QEMU在对处理器虚拟化这一块可以利用KVM提供的功能来提升性能。<h6 id=VMware-Workstation><a title="VMware Workstation" class=headerlink href=#VMware-Workstation></a>VMware Workstation</h6><h6 id=Oracle-Virtualbox><a title="Oracle Virtualbox" class=headerlink href=#Oracle-Virtualbox></a>Oracle Virtualbox</h6><h6 id=Parallels-Desktop><a title="Parallels Desktop" class=headerlink href=#Parallels-Desktop></a>Parallels Desktop</h6><h5 id=硬件辅助的全虚拟化><a class=headerlink href=#硬件辅助的全虚拟化 title=硬件辅助的全虚拟化></a>硬件辅助的全虚拟化</h5><p>硬件辅助全虚拟化主要使用了支持虚拟化功能的CPU进行支撑，CPU可以明确的分辨出来自GuestOS的特权指令，并针对GuestOS进行特权操作，而不会影响到HostOS。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224100058.png><p>从更深入的层次来说，虚拟化CPU形成了新的CPU执行状态: <code>Non-Root Mode</code> 和 <code>Root Mode</code> 。GuestOS运行在Non-Root Mode 的 Ring 0 核心态中，这表明 GuestOS 能够直接执行特权指令而不再需要特权解除和陷入模拟机制。并且在硬件层上面紧接的就是虚拟化层的VMM，而不需要HostOS。这是因为在硬件辅助全虚拟化的VMM会以一种更具协作性的方式来实现虚拟化 —— 将虚拟化模块加载到HostOS的内核中。<p>例如：<code>KVM</code>，KVM通过在HostOS内核中加载 KVM Kernel Module 来将 HostOS 转换成为一个VMM。所以此时VMM可以看作是HostOS，反之亦然。这种虚拟化方式创建的 GuestOS 知道自己是正在虚拟化模式中运行的 GuestOS，KVM就是这样的一种虚拟化实现解决方案。<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=comment>## 判断CPU是否支持硬件虚拟化</span></span><br><span class=line>grep -i -E <span class=string>'(vmx|svm|lm)'</span> /proc/cpuinfo</span><br><span class=line>vmx：Intel VT-x</span><br><span class=line>svm：AMD AMD-v</span><br></pre></table></figure><h6 id=KVM><a class=headerlink href=#KVM title=KVM></a>KVM</h6><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224105720.png><p><code>KVM</code> 是集成到 Linux 内核的 Hypervisor，是x86架构且硬件支持虚拟化技术（Intel-VT 或AMD-V）的 Linux 全虚拟化解决方案。准确来说，KVM是 Linux kernel 的一个模块，可以用来创建虚拟机。但仅有KVM模块是远远不够的，因为用户无法直接控制内核模块去做事，还必须有一个运行在用户空间的工具才行。这个用户空间的工具，KVM开发者选择了已经成型的开源虚拟化软件QEMU。<p><code>QEMU</code>也是一个虚拟化软件，它可以虚拟不同的CPU。比如：在x86的CPU上虚拟一个Power的CPU，并可利用它编译出可运行在Power上的程序。KVM使用了QEMU的一部分，并稍加改造，就成了可控制KVM的用户空间工具。<blockquote><p>KVM只支持x86平台，且依赖于HVM（Intel-VT, AMD-V）。</blockquote><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224113405.png><p><strong>KVM的核心组件</strong><ul><li><code>libvirt</code>：操作和管理KVM虚机的虚拟化 API，使用C语言编写，可以由Python, Ruby, Perl, PHP, Java 等语言调用。可以操作包括KVM，VMware，XEN，Hyper-v, LXC等 Hypervisor;<li><code>Virsh</code>：基于libvirt的命令行工具（CLI）;<li><code>Virt-Manager</code>：基于libvirt的GUI工具;<li><code>virt-v2v</code>：虚机格式迁移工具;<li><code>virt-*工具</code>：包括 <code>Virt-install</code> （创建KVM虚机的命令行工具）， <code>Virt-viewer</code> （连接到虚机屏幕的工具），<code>Virt-clone</code>（虚机克隆工具），<code>virt-top</code>等;<li><code>sVirt</code>：安全工具;</ul><h6 id=VMware-ESXi><a title="VMware ESXi" class=headerlink href=#VMware-ESXi></a>VMware ESXi</h6><p>支持Windows、Linux等操作系统。<h6 id=Microsoft-Hyper-V><a title="Microsoft Hyper-V" class=headerlink href=#Microsoft-Hyper-V></a>Microsoft Hyper-V</h6><p>支持Windows、Linux等操作系统。<h6 id=Xen-HVM><a title="Xen (HVM)" class=headerlink href=#Xen-HVM></a>Xen (HVM)</h6><p>支持Windows、Linux等操作系统。<h4 id=半虚拟化-准虚拟化><a title="半虚拟化 (准虚拟化)" class=headerlink href=#半虚拟化-准虚拟化></a>半虚拟化 (准虚拟化)</h4><p>需要对GuestOS的内核代码做一定的修改(在GuestOS的源代码级别上修改特权指令来回避上述的虚拟化漏洞)，才能将GuestOS运行在半虚拟化的VMM中。<p>半虚拟化除了修改内核外还有另外一种实现方法 —— 在每一个GuestOS中安装半虚拟化软件，e.g. <code>VMTools</code>、<code>RHEVTools</code><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224094456.png><p><code>优点</code>: 性能优越，几乎与原始系统相近；<br><code>缺点</code>: 需要对操作系统进行一定的修改，GuestOS的镜像文件并不通用，更新慢；<h5 id=Xen><a class=headerlink href=#Xen title=Xen></a>Xen</h5><p>Xen是一款虚拟化软件，支持半虚拟化和完全虚拟化。它在不支持VT技术的cpu上也能使用，但是只能以半虚拟化模式运行。半虚拟化模式下，仅支持Linux操作系统。<ul><li>virt-manager（GUI）: 用于管理和安装系统;<li>virt-install: 只用于安装系统;</ul><h4 id=服务器虚拟化总结><a class=headerlink href=#服务器虚拟化总结 title=服务器虚拟化总结></a>服务器虚拟化总结</h4><table><thead><tr><th><th>软件辅助全虚拟化<th>硬件辅助全虚拟化<th>操作系统协助/半虚拟化<tbody><tr><td>实现技术<td>BT和直接执行<td>遇到特权指令转到root模式执行<td>Hypercall<tr><td>客户操作系统修改<td>无需修改客户操作系统<td>无需修改客户操作系统<td>客户操作系统需要修改来支持hypercall，因此它不能运行在物理硬件本身或其他的hypervisor上<tr><td>兼容性<td>好<td>好<td>差，半虚拟化模式下，仅支持Linux操作系统<tr><td>性能<td>差<td>全虚拟化下，CPU需要在两种模式之间切换，带来性能开销；但是，其性能在逐渐逼近半虚拟化。<td>好。半虚拟化下CPU性能开销几乎为0，虚机的性能接近于物理机。<tr><td>应用厂商<td>VMware Workstation, QEMU, Virtual PC<td>VMware ESXi, Microsoft Hyper-V, Xen (HVM), KVM<td>Xen</table><h3 id=内存虚拟化><a class=headerlink href=#内存虚拟化 title=内存虚拟化></a>内存虚拟化</h3><h4 id=软件级内存虚拟化><a class=headerlink href=#软件级内存虚拟化 title=软件级内存虚拟化></a>软件级内存虚拟化</h4><h5 id=虚拟内存><a class=headerlink href=#虚拟内存 title=虚拟内存></a>虚拟内存</h5><h4 id=硬件硬件级内存虚拟化><a class=headerlink href=#硬件硬件级内存虚拟化 title=硬件硬件级内存虚拟化></a>硬件硬件级内存虚拟化</h4><h5 id=Intel-EPT-Extended-Page-Table><a title="Intel EPT (Extended Page Table)" class=headerlink href=#Intel-EPT-Extended-Page-Table></a>Intel EPT (Extended Page Table)</h5><h5 id=AMD-NTP-Nested-Page-Table><a title="AMD NTP (Nested Page Table)" class=headerlink href=#AMD-NTP-Nested-Page-Table></a>AMD NTP (Nested Page Table)</h5><h3 id=存储虚拟化><a class=headerlink href=#存储虚拟化 title=存储虚拟化></a>存储虚拟化</h3><h4 id=LVM><a class=headerlink href=#LVM title=LVM></a>LVM</h4><h5 id=LVM基本术语><a class=headerlink href=#LVM基本术语 title=LVM基本术语></a>LVM基本术语</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224145141.png><ul><li><p><strong>物理存储介质（The Physical Media）</strong>: 这里是指系统的存储设备， 如：/dev/hda1, /dev/sda等，是存储系统最底层的存储单元。</p><li><p><strong>物理卷（PV, Physical Volume）</strong>: 物理卷就是指磁盘，磁盘分区或从逻辑上与磁盘分区具有同样功能的设备（如RAID），是LVM的基本存储逻辑块，但和基本的物理存储介质（如分区，磁盘等）比较，却包含有与LVM相关的管理参数。当前LVM允许你在每个物理卷上保存这个物理卷的0-2分元数据拷贝，默认为1，保存在设备的开始处，为2时，保存在设备的结束处。硬盘分区后(还未格式化为文件系统)使用pvcreate命令可以将分区创建为pv，要求分区的system ID为8e，即为LVM格式的系统标识符。</p><li><p><strong>卷组（VG, Volume Group）</strong>: LVM卷组类似与非LVM系统中的物理硬盘，由其物理卷组成，可以在卷组上创建一个或多个（LVM分区）逻辑卷，LVM卷组由一个或多个物理卷组成。将多个PV组合起来，使用vgcreate命令创建成卷组，这样卷组包含了多个PV就比较大了，相当于重新整合了多个分区后得到的磁盘。虽然VG是整合多个PV的，但是创建VG时会将VG所有的空间根据指定的PE大小划分为多个PE，在LVM模式下的存储都以PE为单元，类似于文件系统的Block。</p><li><p><strong>PE(Physical Extend)</strong>: PE是VG中的存储单元，实际存储的数据都是存储在这里面的。</p><li><p><strong>LV(Logical Volume)</strong>: VG相当于整合过的硬盘，那么LV就相当于分区，只不过该分区是通过VG来划分的。VG中有很多PE单元，可以指定将多少个PE划分给一个LV，也可以直接指定大小(如多少兆)来划分。划分为LV之后就相当于划分了分区，只需再对LV进行格式化即可变成普通的文件系统。</p></ul><h4 id=RAID-技术><a title="RAID 技术" class=headerlink href=#RAID-技术></a>RAID 技术</h4><ul><li>RAID 0</ul><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224143946.png><ul><li>RAID 1</ul><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224144020.png><ul><li>RAID 5</ul><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224144053.png><ul><li>RAID 10</ul><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224144125.png><h3 id=网络虚拟化><a class=headerlink href=#网络虚拟化 title=网络虚拟化></a>网络虚拟化</h3><h3 id=显卡虚拟化><a class=headerlink href=#显卡虚拟化 title=显卡虚拟化></a>显卡虚拟化</h3><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224091804.png><h3 id=桌面虚拟化><a class=headerlink href=#桌面虚拟化 title=桌面虚拟化></a>桌面虚拟化</h3><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224091616.png><h3 id=容器虚拟化><a class=headerlink href=#容器虚拟化 title=容器虚拟化></a>容器虚拟化</h3><h4 id=LXC><a class=headerlink href=#LXC title=LXC></a>LXC</h4><h4 id=libcontainer><a class=headerlink href=#libcontainer title=libcontainer></a>libcontainer</h4><h4 id=runC><a class=headerlink href=#runC title=runC></a>runC</h4><h4 id=openvz><a class=headerlink href=#openvz title=openvz></a>openvz</h4><h3 id=云管平台><a class=headerlink href=#云管平台 title=云管平台></a>云管平台</h3><h4 id=OpenStack><a class=headerlink href=#OpenStack title=OpenStack></a>OpenStack</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224091104.png><h4 id=VMware-vSphere><a title="VMware vSphere" class=headerlink href=#VMware-vSphere></a>VMware vSphere</h4><h2 id=分布式系统架构><a class=headerlink href=#分布式系统架构 title=分布式系统架构></a>分布式系统架构</h2><h3 id=分布式理论><a class=headerlink href=#分布式理论 title=分布式理论></a>分布式理论</h3><h4 id=CAP理论><a class=headerlink href=#CAP理论 title=CAP理论></a>CAP理论</h4><p><code>CAP</code>是”Consistency”,”Availabilty”,”Partition Tolerance”的简称，分别代表了: 强一致性，可用性和分区容忍性，它们的含义分别如下:<ul><li><strong>强一致性</strong>: 在分布式系统同一份数据有多副本的情况下,对于数据的操作效果和只有单份数据一样。<li><strong>可用性</strong>: 客户端在任何时刻对数据的读/写操作都应该保证在时限内完成。<li><strong>分区容忍性</strong>: 当分布式系统出现网络分区,不同分区间的机器无法进行网络通信时,系统仍然能够继续工作。</ul><h4 id=BASE理论><a class=headerlink href=#BASE理论 title=BASE理论></a>BASE理论</h4><p>由CAP定理可知,在分布式系统中过于追求数据的强一致性将导致可用性一定程度被牺牲,这意味着系统将不能很好的响应用户的请求,这会一定程度影响用户体验。因而对于大部分布式系统而言,应当在保证系统高可用的前提下去追求数据的一致性,BASE原则正是对这一思想的描述。<p>BASE理论的核心思想是: 把分布式系统的可用性放在首位，放弃CAP中对数据强一致性的追求，只要系统能保证数据最终一致。<ul><li><strong>基本可用(Basically Available)</strong>: 系统在绝大部分时间应处于可用状态,允许出现故障损失部分可用性,但保证核心可用。<li><strong>软状态(Soft State)</strong>: 数据状态不要求在任何时刻都保持一致,允许存在中间状态,而该状态不影响系统可用性。对于多副本的存储系统而言,就是允许副本之间的同步存在延时,并且在这个过程中系统依旧可以响应客户端请求。<li><strong>最终一致性(Eventual Consistency)</strong>: 尽管软状态不要求分布式数据在任何时刻都保持一致,但经过一定时间后,这些数据最终能达到一致性状态。</ul><h4 id=CAP-BASE-ACID的关系><a title="CAP, BASE, ACID的关系" class=headerlink href=#CAP-BASE-ACID的关系></a>CAP, BASE, ACID的关系</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225103853.png><h3 id=幂等性><a class=headerlink href=#幂等性 title=幂等性></a>幂等性</h3><h4 id=解决幂等的方法><a class=headerlink href=#解决幂等的方法 title=解决幂等的方法></a>解决幂等的方法</h4><ul><li><strong>全局唯一ID</strong>：根据业务生成一个全局唯一ID,在调用接口时会传入该ID,接口提供方会从相应的存储系统比如Redis中去检索这个全局ID是否存在,如果存在则说明该操作已经执行过了,将拒绝本次服务请求;否则将相应该服务请求并将全局ID存入存储系统中,之后包含相同业务ID参数的请求将被拒绝。<li><strong>去重表</strong>：这种方法适用于在业务中有唯一标识的插入场景。比如在支付场景中,一个订单只会支付一次,可以建立一张去重表,将订单ID作为唯一索引。把支付并且写入支付单据到去重表放入一个事务中,这样当出现重复支付时,数据库就会抛出唯一约束异常,操作就会回滚。这样保证了订单只会被支付一次。<li><strong>多版本并发控制</strong>：适合对更新请求作幂等性控制,比如要更新商品的名字,这是就可以在更新的接口中增加一个版本号来做幂等性控制<li><strong>状态机控制</strong>：适合在有状态机流转的情况下,比如订单的创建和付款,订单的创建肯定是在付款之前。这是可以添加一个int类型的字段来表示订单状态,创建为0,付款成功为100,付款失败为99,则对订单状态的更新就可以这样表示。<li><strong>插入或更新</strong>：在MySQL数据库中，如果在insert语句后面带上ON DUPLICATE KEY UPDATE 子句，而要插入的行与表中现有记录的惟一索引或主键中产生重复值,则对旧行进行更新;否则执行新纪录的插入。我们可以利用该特性防止记录的重复插入,比如good_id和category_id构成唯一索引,则重复执行多次该SQL,数据库中也只会有一条记录。</ul><h2 id=微服务框架选型><a class=headerlink href=#微服务框架选型 title=微服务框架选型></a>微服务框架选型</h2><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023093735.png><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023094032.png><h3 id=RESTful框架><a class=headerlink href=#RESTful框架 title=RESTful框架></a>RESTful框架</h3><h4 id=Spring-Cloud><a title="Spring Cloud" class=headerlink href=#Spring-Cloud></a>Spring Cloud</h4><p>Spring Cloud，来源于 Spring Source ，具有 Spring 社区的强大背书外，还有 Netflix 强大的后盾与技术输出。Netflix 作为一家成功实践微服务架构的互联网公司，在几年前就把几乎整个微服务框架栈开源贡献给了社区，这些框架开源的整套微服务架构套件是 Spring Cloud 的核心。<ul><li><code>Spring Cloud Config</code>: 配置中心，利用 Git 集中管理程序的配置。<li><code>Spring Cloud Eureka</code>: 服务中心（类似于管家的概念，需要什么直接从这里取，就可以了），一个基于 REST 的服务，用于定位服务，以实现云端中间层服务发现和故障转移。<li><code>Spring Cloud Hystrix</code>: 熔断器，容错管理工具，旨在通过熔断机制控制服务和第三方库的节点，从而对延迟和故障提供更强大的容错能力。<li><code>Spring Cloud Zuul</code>: 网关，是在云平台上提供动态路由，监控，弹性，安全等边缘服务的框架。Web 网站后端所有请求的前门。<li><code>Spring Cloud Ribbon</code>: 负载均衡。<li><code>Spring Cloud Fegin</code>: REST客户端。<li><code>Spring Cloud Bus</code>: 消息总线，利用分布式消息将服务和服务实例连接在一起，用于在一个集群中传播状态的变化。<li><code>Spring Cloud Security</code> 安全控制，在 Zuul 代理中为 OAuth2 REST 客户端和认证头转发提供负载均衡。<li><code>Spring Cloud Sleuth</code>: 分布式链路监控，SpringCloud 应用的分布式追踪系统，和 Zipkin，HTrace，ELK 兼容。<li><code>Spring Cloud Stream</code>: 消息组件，基于 Redis，Rabbit，Kafka 实现的消息微服务，简单声明模型用以在 Spring Cloud 应用中收发消息。</ul><h3 id=RPC框架><a class=headerlink href=#RPC框架 title=RPC框架></a>RPC框架</h3><ul><li>求稳：Dubbo, thrift<li>追新：gRPC</ul><h4 id=Thrift><a class=headerlink href=#Thrift title=Thrift></a>Thrift</h4><h4 id=gRPC><a class=headerlink href=#gRPC title=gRPC></a>gRPC</h4><h4 id=Dubbo><a class=headerlink href=#Dubbo title=Dubbo></a>Dubbo</h4><p>Dubbo 是一个分布式服务框架，是国内互联网公司开源做的比较不错的阿里开放的微服务化治理框架，致力于提供高性能和透明化的RPC远程服务调用方案，以及SOA服务治理方案。其核心部分包含:<ul><li>远程通讯: 提供对多种基于长连接的NIO框架抽象封装，包括多种线程模型，序列化，以及“请求-响应”模式的信息交换方式；<li>集群容错: 提供基于接口方法的透明远程过程调用，包括多协议支持，以及软负载均衡，失败容错，地址路由，动态配置等集群支持；<li>自动发现: 基于注册中心目录服务，使服务消费方能动态的查找服务提供方，使地址透明，使服务提供方可以平滑增加或减少机器。</ul><h4 id=Dubbox><a class=headerlink href=#Dubbox title=Dubbox></a>Dubbox</h4><p>当当 Dubbox 扩展了 Dubbo 支持 RESTful 接口暴露能力。<h3 id=新锐框架><a class=headerlink href=#新锐框架 title=新锐框架></a>新锐框架</h3><h4 id=Istio><a class=headerlink href=#Istio title=Istio></a>Istio</h4><p>Istio 作为用于微服务服务聚合层管理的新锐项目，是 Google、IBM、Lyft（海外共享出行公司、Uber劲敌） 首个共同联合开源的项目，提供了统一的连接，安全，管理和监控微服务的方案。<p>目前首个测试版是针对 Kubernetes 环境的，社区宣称在未来几个月内会为虚拟机和 Cloud Foundry 等其他环境增加支持。 Istio 将流量管理添加到微服务中，并为增值功能（如安全性，监控，路由，连接管理和策略）创造了基础。<ul><li>HTTP、gRPC 和 TCP 网络流量的自动负载均衡；<li>提供了丰富的路由规则，实现细粒度的网络流量行为控制；<li>流量加密、服务间认证，以及强身份声明；<li>全范围（Fleet-wide）的策略执行；<li>深度遥测和报告。</ul><h2 id=消息队列MQ><a class=headerlink href=#消息队列MQ title=消息队列MQ></a>消息队列MQ</h2><ul><li>轻量级：RabbitMQ<li>重量级：Kafka, RocketMQ<li>没有特殊原因，不要选择ActiveMQ</ul><table><thead><tr><th><th>Kafka<th>RocketMQ<th>RabbitMQ<tbody><tr><td>设计定位<td>系统间的数据流管道，实时数据处理。例如：常规消息系统、网站活性跟踪、监控数据、日志收集、处理等<td>非日志的可靠消息传输，例如：交易、订单、充值、流计算、消息推送、流失处理，binglog分发等<td>可靠消息传输，和RocketMQ类似<tr><td>成熟度<td>日志领域成熟<td>成熟<td>成熟<tr><td>所属<td>Apache<td>Alibaba -> Apache<td>Mozilla Public License<tr><td>社区活跃度<td>高<td>中<td>高<tr><td>API完备性<td>高<td>高<td>高<tr><td>文档完备性<td>高<td>高<td>高<tr><td>开发语言<td>Scala<td>Java<td>Erlang<tr><td>支持协议<td>一套自行设计的基于TCP的二进制协议<td>自己定义的一套协议<td>AMQP<tr><td>客户端语言<td>C/C++, Python, Go, Erlang, .NET, Ruby, Node.js, PHP等<td>Java<td>Java, C, C++, Python, PHP, Perl等<tr><td>持久化方式<td>磁盘文件<td>磁盘文件<td>内存、文件<tr><td>部署方式<td>单机/集群<td>单机/集群<td>单机/集群<tr><td>集群管理<td>Zookeeper<td>name server<td><tr><td>选主方式<td>从ISR中自动选举一个leader<td>不支持自动选主，通过设定brokername, brockerid实现。brokername相同，brockerid=0时为master,其他为slave<td>最早加入集群的broker<tr><td>可用性<td>非常高，分布式主从<td>非常高，分布式主从<td>高，主从，采用镜像模式实现，数据量大时可能产生性能瓶颈<tr><td>主从切换<td>自动切换，N个副本，允许N-1个失败；master失效后自动从ISR中选举一个master<td>不支持自动切换。master失效以后，不能向master发送消息，consumer大概30s(默认)可感知此事件，伺候从slave消费。如果master无法恢复，异步复制时可能出现部分信息丢失。<td>自动切换。最早加入集群的slave会成为master<tr><td>数据可靠性<td>很好。支持producer单挑发送、同步刷盘、同步复制<td>很好。producer单条发送，broker端支持同步刷盘、异步刷盘，同步双写、异步复制<td>好。producer支持同步/异步ack，支持队列数据持久化，镜像模式中支持主动同步。<tr><td>消息写入性能<td>非常好。每条10个字节测试：百万条/s<td>很好。每条10个字节测试：单机单broker 7万/s，单机 3 broker 12万/s<td>RAM约为RocketMQ的1/2，Disk性能约为RAM性能的1/3<tr><td>性能稳定性<td>队列/分区多时性能不稳定，明显下降。消息堆积时性能稳定。<td>队列较多、消息堆积时性能稳定。<td>消息堆积时，性能不稳定。<tr><td>单机支持的队列数<td>单机超过64个队列/分区，Load会发生明显的飘高现象。队列越多，load越高，发送消息响应时间边长<td>单机支持最高5万个队列，Load不会发生明显变化<td>依赖于内存<tr><td>堆积能力<td>非常好。消息存储在log中，每个分区一个log文件<td>非常好。所有消息存储在同一个commit log中<td>一般<tr><td>复制备份<td>消息先写入leader的log，followers从leader中pull，然后先ack leader，在写入log中。ISR中维护与leader不同的列表，落后太多的follower会被删除。<td>同步双写，异步复制；slave启动线程从master中拉数据<td>普通模式下不复制；镜像模式下，消息先到master，然后写到slave上。<tr><td>消息投递实时性<td>毫秒级。具体由consumer轮训间隔时间决定<td>毫秒级。支持pull、push两种模式，延时通常在毫秒级<td>毫秒级<tr><td>顺序消费<td>支持；单是一台broker宕机后，就会产生消息乱序<td>支持；在顺序消息场景下，消费失败时消费队列将会暂停<td>支持；但如果一个消费失败，此消息的顺序会被打乱<tr><td>定时消息<td>不支持<td>开源版本仅支持定时Level<td>不支持<tr><td>事务消息<td>不支持<td>支持<td>不支持<tr><td>Broker端消息过滤<td>不支持<td>支持，通过tag过滤，类似子topic<td>不支持<tr><td>消息查询<td>不支持<td>支持，根据MessageId查询，支持根据MessageKey查询<td>不支持<tr><td>消息失败重试<td>不支持<td>支持，offset存储在broker中<td>支持<tr><td>消息重新消费<td>支持；通过修改offset来重新消费<td>支持；按照时间来重新消费<td><tr><td>发送端负载均衡<td>可自由指定<td>可自由指定<td>需要单独loadbalancer支持<tr><td>消费并行度<td>跟分区数一致<td>顺序消费：与分区数一致；乱序消费：消费服务器的消费线程数之和<td>镜像模式下其实也是从master消费<tr><td>消费方式<td>consumer pull<td>consumer pull/broker push<td>broker push<tr><td>批量发送<td>支持，默认producer缓存、压缩，然后批量发送<td>不支持<td>不支持<tr><td>消息清理<td>指定文件保存时间，过期删除<td>指定文件保存时间，过期删除<td>可用内存少于40%（默认），触发gc。gc时找到相邻的两个文件，合并right文件到left<tr><td>访问权限控制<td>无<td>无<td>类似数据库，需要配置用户名密码<tr><td>系统维护<td>Scala语言开发，维护成本高<td>Java语言开发，维护成本低<td>Erlang语言开发，维护成本高<tr><td>部署依赖<td>Zookeeper<td>nameserver<td>Erlang环境<tr><td>管理后台<td>官方不提供，第三方开源管理工具可使用，不用重新开发<td>官方提供，rocketmq-console<td>官方提供，rabbitmqadmin<tr><td>优点<td>1. 在高吞吐、低延迟、高可用、集群热扩展、集群容错上有非常好的表现；2. producer端提供缓存、压缩功能，可节省性能，提高效率。3. 提供顺序消费能力；4. 提供多种客户端语言支持；5. 生态完善，在大数据处理昂面有大量配套设施。<td>1. 在高吞吐、低延迟、高可用上有非常好的表现，消息堆积时，性能也很好。2. API、系统设计都更加适应业务处理场景。3. 支持多种消费方式。4.支持broker消息过滤；5.支持事务；6. 提供消息顺序消费能力：consumer可以水平扩展，消费能力很强；7. 集群规模在50台左右，单日处理消息上百亿；经理过大数据量的考验，比较稳定可靠。<td>1. 在高吞吐量、高可用上较前两者有所不足；2. 支持多种客户端语言，支持AMQP协议；3. 由于Erlang语言的特性，性能也比较好；使用RAM模式时，性能很好。4. 管理界面较丰富，在互联网公司也有较大规模的应用。<tr><td>缺点<td>1. 消费集群数目受分区数目限制；2. 单机topic多时，性能会明显降低；3. 不支持事务；<td>1. 相比于Kafka，使用者较少，生态不够完善；消息堆积、吞吐率上也有所不足；2. 不支持主从自动切换，master失效后，消费者要一定时间才能感知到；3. 客户端只支持Java<td>1. Erlang语言难度较大，集群不支持动态扩展；2. 不支持事务、消息吞吐能力有限；3. 消息堆积时，性能会明显降低。</table><h3 id=Kafka><a class=headerlink href=#Kafka title=Kafka></a>Kafka</h3><p>适用于可靠性要求较高的业务场景。<h3 id=RabbitMQ><a class=headerlink href=#RabbitMQ title=RabbitMQ></a>RabbitMQ</h3><p>队列特性和文档都很丰富，性能和分布式能力稍弱，中小规模场景可选。<h3 id=RocketMQ><a class=headerlink href=#RocketMQ title=RocketMQ></a>RocketMQ</h3><p>适用于可靠性要求较高的业务场景。<h3 id=Spring-Cloud-Stream><a title="Spring Cloud Stream" class=headerlink href=#Spring-Cloud-Stream></a>Spring Cloud Stream</h3><p>基于Redis,Rabbit,Kafka实现的消息微服务，简单声明模型用以在Spring Cloud应用中收发消息。<h2 id=数据库><a class=headerlink href=#数据库 title=数据库></a>数据库</h2><h3 id=RDBMS-vs-NoSQL><a title="RDBMS vs NoSQL" class=headerlink href=#RDBMS-vs-NoSQL></a>RDBMS vs NoSQL</h3><table><thead><tr><th><th>RDBMS<th>NoSQL<th>备注<tbody><tr><td>数据库原理<td>完全支持<td>部分支持<td>RDBMS有关系数据论作为基础，而NoSQL没有统一的理论基础。<tr><td>数据规模<td>大<td>超大<td>RDBMS很难实现横向扩展，纵向扩展空间也比较有限，性能会随着数据规模的增大而降低。NoSQL可以很容易通过添加更多设备来支持更大规模的数据。<tr><td>数据库模式<td>固定<td>灵活<td>RDBMS需要定义数据库模式，严格遵守数据定义和相关约束条件。NoSQL不存在数据库模式，可以自由灵活定义并存储各种不同类型的数据。<tr><td>查询效率<td>快<td>可以实现高效简单查询，但不具备高度结构化查询等特性，复杂查询性能不尽如人意。<td>RDBMS借助于索引机制可以实现快速查询（包括记录查询和范围查询）。很多NoSQL数据库没有面向复杂查询的索引，虽然NoSQL可以使用MapReduce来加速查询，但在复杂查询方面，性能仍然不如RBDMS。<tr><td>一致性<td>强一致性<td>弱一致性<td>RDBMS严格遵守事务ACID模型，可以保证事务强一致性。很多NoSQL数据库放松了对事务ACID四性的要求，而是遵守BASE模型，保证最终一致性。<tr><td>数据完整性<td>容易实现<td>很难实现<td>任何一个RDBMS都可以很容易实现数据完整性，比如通过主键或非空约束来实现，通过主键、外键来实现参照完整性，通过约束或触发器来实现用户自定义完整性。但NoSQL数据库无法实现。<tr><td>扩展性<td>一般<td>好<td>RDBMS很难实现横向扩展，纵向扩展空间也比较有限，性能会随着数据规模的增大而降低。NoSQL在设计之初就充分考虑了横向扩展的需求，可以很容易通过添加廉价设备实现扩展。<tr><td>可用性<td>好<td>很好<td>RDBMS在任何时候都以保证数据一致性为优先目标，其次才是优化系统性能。随着数据规模的增大，RBDMS为了保证严格的一致性，只能提供相对较弱的可用性。大多数NoSQL都能提供较高的可用性。<tr><td>标准化<td>是<td>否<td>RDBMS已经标准化（SQL）。NoSQL还没有行业标准，不同的NoSQL数据库有自己的查询语言，很难规范应用接口。<tr><td>技术支持<td>高<td>低<td>RDBMS经理了几十年的发展，已经非常成熟，Oracle等大厂都可以提供很好的技术支持。NoSQL在技术支持方面仍然处于起步阶段，还不成熟明确罚有力的技术支持。<tr><td>可维护性<td>复杂<td>复杂<td>RDBMS需要专门的数据库管理员（DBA）维护。NoSQL数据库虽然没有RDBMS复杂，也难以维护。</table><table><thead><tr><th><th>产品名称<th>特点<tbody><tr><td>列存储<td>Hbase, Cassandra, Hypertable<td>按列存储数据，最大的特点是方便存储结构化和半结构化数据，方便做数据压缩。针对某一列或者某几列的查询有非常大的IO优势。<tr><td>文档存储<td>MongoDB, CouchDB<td>文档存储一般用类似json的存储格式，内容是文档类型的。这样就有机会对某些字段简历索引，实现关系数据库的某些功能。<tr><td>key-value存储<td>Redis, Memcache<td>可以通过key快速查询到其对应的value。一般来说，存储不管value的格式，照单全收。<tr><td>图存储<td>Neo4J, FlockDB, InfoGrid<td>图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且涉及使用不方便。<tr><td>对象存储<td>db4o, Versant<td>通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。<tr><td>xml数据库<td>Berkeley DB, BaseX<td>高效的存储XML数据，并支持xml的内部查询语法，如：XQuery, Xpath</table><h3 id=事务><a class=headerlink href=#事务 title=事务></a>事务</h3><h4 id=事务的基本要素（ACID）><a class=headerlink href=#事务的基本要素（ACID） title=事务的基本要素（ACID）></a>事务的基本要素（ACID）</h4><ul><li><p><code>原子性（Atomicity）</code>：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。</p><li><p><code>一致性（Consistency）</code>：事务开始前和结束后，数据库的完整性约束没有被破坏。比如A向B转账，不可能A扣了钱，B却没收到。</p><li><p><code>隔离性（Isolation）</code>：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。</p><li><p><code>持久性（Durability）</code>：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</p></ul><h4 id=事务的并发问题><a class=headerlink href=#事务的并发问题 title=事务的并发问题></a>事务的并发问题</h4><h5 id=脏读><a class=headerlink href=#脏读 title=脏读></a>脏读</h5><p><code>脏读</code>：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据。<h5 id=不可重复读><a class=headerlink href=#不可重复读 title=不可重复读></a>不可重复读</h5><p><code>不可重复读</code>：事务A多次读取同一数据，事务B在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果不一致。<h5 id=幻读><a class=headerlink href=#幻读 title=幻读></a>幻读</h5><p><code>幻读</code>：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样。<blockquote><p>小结：不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表。</blockquote><h4 id=二阶段提交（2PC）><a class=headerlink href=#二阶段提交（2PC） title=二阶段提交（2PC）></a>二阶段提交（2PC）</h4><p><code>两阶段提交（2PC）</code>是 Oracle Tuxedo 系统提出的<code>XA</code>分布式事务协议的其中一种实现方式。<p>XA协议中有两个重要角色：<ul><li>事务协调者<li>事务参与者</ul><h5 id=第一阶段><a class=headerlink href=#第一阶段 title=第一阶段></a>第一阶段</h5><h6 id=正常情况><a class=headerlink href=#正常情况 title=正常情况></a>正常情况</h6><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225081336.png><ul><li>事务协调者的节点会首先向所有的参与者节点发送 <code>Prepare(预备)</code> 请求。<li>在接到 Prepare(预备) 请求之后，每一个参与者节点会各自执行与事务有关的数据更新，写入<code>Undo Log</code>和<code>Redo Log</code>。<li>参与者执行成功，暂时不提交事务，向事务协调节点返回 <code>done(完成)</code> 消息。<li>进入第二阶段</ul><h6 id=出错时><a class=headerlink href=#出错时 title=出错时></a>出错时</h6><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225081520.png><p>如果某个事务参与者反馈失败消息，说明该节点的本地事务执行不成功，必须回滚。<ul><li>事务协调者的节点会首先向所有的参与者节点发送 <code>Prepare(预备)</code> 请求；<li>在接到 Prepare(预备) 请求之后，每一个参与者节点会各自执行与事务有关的数据更新，写入<code>Undo Log</code>和<code>Redo Log</code>；<li>参与者执行失败，<code>返回失败消息</code>；<li>协调者<code>中断事务</code>；</ul><h6 id=中断事务><a class=headerlink href=#中断事务 title=中断事务></a>中断事务</h6><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225081829.png><p>任何一个参与者向协调者反馈了 No 响应，或者在等待超时之后，协调者尚无法接收到所有参与者的反馈响应，那么就会中断事务。<ul><li>发送回滚请求: 协调者向所有参与者节点发出 <code>Rollback</code> 请求；<li>事务回滚: 参与者收到Rollback请求之后，会利用其在阶段一记录的 <code>Undo log</code> 来执行事务回滚操作，并在完成回滚之后释放在整个事务执行期间占用的资源；<li>反馈事务回滚结果：参与者在完成事务回滚之后，向协调者发送 <code>Ack</code> 消息；<li>协调者<code>中断事务</code>；</ul><h5 id=第二阶段><a class=headerlink href=#第二阶段 title=第二阶段></a>第二阶段</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225082120.png><ul><li>如果事务协调者在之前所收到都是正向返回，那么它将会向所有事务参与者发出<code>Commit</code>请求。<li>接到Commit请求之后，事务参与者节点会各自进行本地的事务提交<code>commit</code>，并释放锁资源。当本地事务完成提交后，将会向事务协调者返回<code>ACK</code>消息。<li>当事务协调者接收到所有事务参与者的“ACK”反馈，整个分布式事务完成。</ul><p><strong>缺点：</strong><ul><li><code>效率低</code>：两阶段提交涉及多次节点间的网络通信，通信时间长！且在整个过程中，所有节点都处于阻塞状态，所有节点所持有的资源（例如数据库数据，本地文件等）都处于锁定状态；<li><code>单点故障</code>：由于协调者的重要性，一旦协调者发生故障。参与者会一直阻塞下去。尤其在第二阶段，协调者发生故障，那么所有的参与者还都处于锁定事务资源的状态中，而无法继续完成事务操作。（如果是协调者挂掉，可以重新选举一个协调者，但是无法解决因为协调者宕机导致的参与者处于阻塞状态的问题）；<li><code>数据不一致</code>：在二阶段提交的阶段二中，当协调者向参与者发送commit请求之后，发生了局部网络异常或者在发送commit请求过程中协调者发生了故障，这回导致只有一部分参与者接受到了commit请求。而在这部分参与者接到commit请求之后就会执行commit操作。但是其他部分未接到commit请求的机器则无法执行事务提交。于是整个分布式系统便出现了数据不一致性的现象。</ul><h4 id=三阶段提交（3PC）><a class=headerlink href=#三阶段提交（3PC） title=三阶段提交（3PC）></a>三阶段提交（3PC）</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191225083102.png><h5 id=CanCommit阶段><a class=headerlink href=#CanCommit阶段 title=CanCommit阶段></a>CanCommit阶段</h5><ul><li>事务询问: 协调者向参与者发送CanCommit请求。询问是否可以执行事务提交操作。然后开始等待参与者的响应;<li>响应反馈: 参与者接到CanCommit请求之后，正常情况下，如果其自身认为可以顺利执行事务，则返回Yes响应，并进入预备状态。否则反馈No；</ul><h5 id=PreCommit阶段><a class=headerlink href=#PreCommit阶段 title=PreCommit阶段></a>PreCommit阶段</h5><p>协调者根据参与者的反应情况来决定是否可以进行事务的PreCommit操作。<br>根据响应情况，有以下两种可能。<p><strong>假如协调者从所有的参与者获得的反馈都是Yes响应，那么就会执行事务的预执行。</strong><ul><li><code>发送预提交请求</code>：协调者向参与者发送<code>PreCommit</code>请求，并进入<code>Prepared阶段</code>。<li><code>事务预提交</code>：参与者接收到PreCommit请求后，会执行事务操作，并将<code>undo和redo</code>信息记录到事务日志中。<li><code>响应反馈</code>：如果参与者成功的执行了事务操作，则返回<code>ACK</code>响应，同时开始等待最终指令。</ul><p><strong>假如有任何一个参与者向协调者发送了No响应，或者等待超时之后，协调者都没有接到参与者的响应，那么就执行事务的中断。</strong><ul><li><code>发送中断请求</code>: 协调者向所有参与者发送<code>abort</code>请求。<li><code>中断事务</code>: 参与者收到来自协调者的abort请求之后（或超时之后，仍未收到协调者的请求），执行事务的中断。</ul><h5 id=doCommit阶段><a class=headerlink href=#doCommit阶段 title=doCommit阶段></a>doCommit阶段</h5><p>该阶段进行真正的事务提交，也可以分为以下两种情况。<p><strong>执行提交</strong><ul><li><code>发送提交请求</code>: 协调接收到参与者发送的ACK响应，那么他将从预提交状态进入到提交状态。并向所有参与者发送<code>doCommit请求</code>。<li><code>事务提交</code>: 参与者接收到doCommit请求之后，执行正式的<code>事务提交commit</code>。并在完成事务提交之后释放所有事务资源。<li><code>响应反馈</code>: 事务提交完之后，向协调者发送<code>Ack</code>响应。<li><code>完成事务</code>: 协调者接收到所有参与者的ack响应之后，完成事务。</ul><p><strong>中断事务</strong><p>协调者没有接收到参与者发送的ACK响应（可能是接受者发送的不是ACK响应，也可能响应超时），那么就会执行中断事务。<ul><li><code>发送中断请求</code>: 协调者向所有参与者发送abort请求;<li><code>事务回滚</code>: 参与者接收到abort请求之后，利用其在阶段二记录的undo信息来执行事务的回滚操作，并在完成回滚之后释放所有的事务资源;<li><code>反馈结果</code>: 参与者完成事务回滚之后，向协调者发送ACK消息;<li><code>中断事务</code>: 协调者接收到参与者反馈的ACK消息之后，执行事务的中断;</ul><h4 id=2PC与3PC的区别><a class=headerlink href=#2PC与3PC的区别 title=2PC与3PC的区别></a>2PC与3PC的区别</h4><p>相对于2PC，3PC主要解决的<code>单点故障</code>问题，并<code>减少阻塞</code>，因为一旦参与者无法及时收到来自协调者的信息之后，他会默认执行commit，而不会一直持有事务资源并处于阻塞状态。但是这种机制也会导致数据一致性问题，因为，由于网络原因，协调者发送的abort响应没有及时被参与者接收到，那么参与者在等待超时之后执行了commit操作，这样就和其他接到abort命令并执行回滚的参与者之间存在数据不一致的情况。<h3 id=MySQL><a class=headerlink href=#MySQL title=MySQL></a>MySQL</h3><h4 id=MySQL事务隔离级别><a class=headerlink href=#MySQL事务隔离级别 title=MySQL事务隔离级别></a>MySQL事务隔离级别</h4><table><thead><tr><th>事务隔离级别<th>脏读<th>不可重复读<th>幻读<th>备注<tbody><tr><td>读未提交（read-uncommitted）<td>是<td>是<td>是<td><tr><td>不可重复读（read-committed）<td>否<td>是<td>是<td>写数据只会锁住相应行<tr><td>可重复读（repeatable-read）<td>否<td>否<td>是<td>如果检索条件有索引，默认加锁方式是next-key锁；如果没有索引，更新时会锁住整张表<tr><td>串行化（serializable）<td>否<td>否<td>否<td>读写数据都会锁住整张表</table><p><strong>修改事务隔离级别</strong><figure class="highlight sql"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>set</span> session transaction isolation level read uncommitted;</span><br></pre></table></figure><h4 id=MyISAM与InnoDB的区别><a class=headerlink href=#MyISAM与InnoDB的区别 title=MyISAM与InnoDB的区别></a>MyISAM与InnoDB的区别</h4><table><thead><tr><th><th>InnoDB<th>MyISAM<tbody><tr><td>事务<td>支持<td>不支持<tr><td>锁支持<td>行级锁<td>表级锁<tr><td>MVCC<td>支持<td>不支持<tr><td>外键<td>支持<td>不支持<tr><td>全文索引<td>不支持<td>支持<tr><td>崩溃恢复<td>支持<td>不支持</table><blockquote><p><code>MVCC</code>: Multi-Version Concurrency Control，多版本并发控制。是指在使用<code>READ COMMITTD</code>、<code>REPEATABLE READ</code>这两种隔离级别的事务执行普通的<code>SEELCT</code>操作时访问记录的版本链的过程，这样可以使不同事务的读-写、写-读操作并发执行，从而提升系统性能。<br><strong>同一份数据临时保存多个版本的一种方式，进而实现并发控制。</strong></blockquote><blockquote><p><code>不可重复读 (READ COMMITTD)</code>: 在<code>每一次</code>进行 SELECT 操作前都会生成一个<code>ReadView</code>;<br><code>可重复读 (REPEATABLE READ)</code>: <code>只在第一次</code>进行 SELECT 操作前生成一个ReadView，之后的查询操作都重复这个ReadView就好了。</blockquote><h4 id=InnoDB锁机制><a class=headerlink href=#InnoDB锁机制 title=InnoDB锁机制></a>InnoDB锁机制</h4><ul><li><strong>共享锁（读锁）</strong>：不堵塞，多个用户可以同时读一个资源，互不干扰。<li><strong>排他锁（写锁）</strong>：会阻塞其他的读锁和写锁，这样可以只允许一个用户进行写入，防止其他用户读取正在写入的资源。</ul><blockquote><p>InnoDB是基于<strong>索引</strong>来完成<strong>行锁</strong>。<br>例: <code>select * from tab_with_index where id = 1 for update;</code><br><code>for update</code> 可以根据条件来完成行锁锁定,并且<code>id</code>是有索引键的列。如果<code>id</code>不是索引键那么InnoDB将完成表锁。</blockquote><h4 id=InnoDB日志><a class=headerlink href=#InnoDB日志 title=InnoDB日志></a>InnoDB日志</h4><h5 id=日志种类><a class=headerlink href=#日志种类 title=日志种类></a>日志种类</h5><ul><li>错误日志：记录出错信息，也记录一些警告信息或者正确的信息。<li>查询日志：记录所有对数据库请求的信息，不论这些请求是否得到了正确的执行。<li>慢查询日志：设置一个阈值，将运行时间超过该值的所有SQL语句都记录到慢查询的日志文件中。<li>二进制日志：记录对数据库执行更改的所有操作。<li>中继日志：中继日志也是二进制日志，用来给slave库恢复。<li>事务日志：重做日志(redo)和回滚日志(undo)。</ul><h5 id=binlog日志格式><a class=headerlink href=#binlog日志格式 title=binlog日志格式></a>binlog日志格式</h5><ul><li>Statement: 每一条会修改数据的sql都会记录在binlog中；<li>Row: 不记录sql语句上下文相关信息，仅保存哪条记录被修改；<li>Mixedlevel: 是以两种level混合使用。一般的语句修改使用statment格式保存binlog，如一些函数，statement无法完成主从复制的操作，则采用row格式保存binlog。</ul><h4 id=备份><a class=headerlink href=#备份 title=备份></a>备份</h4><h5 id=mysqldump><a class=headerlink href=#mysqldump title=mysqldump></a>mysqldump</h5><h5 id=xtranbackup><a class=headerlink href=#xtranbackup title=xtranbackup></a>xtranbackup</h5><h4 id=慢查询><a class=headerlink href=#慢查询 title=慢查询></a>慢查询</h4><ul><li>监控工具: <code>zabbix</code>，<code>lepus</code><li>show profile: 服务器上所有执行语句会记录执行时间，存到临时表中。<li>show status: 会返回一些计数器，可以推测出哪些操作代价较高或者消耗时间多。<li>show processlist: 观察是否有大量线程处于不正常的状态或特征。<li>explain: 执行计划。</ul><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224133520.png><h4 id=分区表><a class=headerlink href=#分区表 title=分区表></a>分区表</h4><ul><li>分区表工作原理</ul><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224133639.png><p>对用户而言，分区表是一个独立的逻辑表，但是底层MySQL将其分成了多个物理子表，这对用户来说是透明的，每一个分区表都会使用一个独立的表文件。<p>创建表时使用<code>partition by</code>子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有需要的数据的分区，这样只需要查询数据所在分区即可。<h4 id=分库分表><a class=headerlink href=#分库分表 title=分库分表></a>分库分表</h4><p>分库分表工作原理: 通过一些HASH算法或者工具实现将一张数据表垂直或者水平进行物理切分。<ul><li>水平分表<li>垂直分表</ul><h4 id=MySQL主从复制><a class=headerlink href=#MySQL主从复制 title=MySQL主从复制></a>MySQL主从复制</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224134238.png><ol><li>在Slave服务器上执行<code>start slave</code>命令开启主从复制开关，开始进行主从复制。<li>此时，Slave服务器的<code>IO线程</code>会通过在master上已经授权的复制用户权限请求连接Master服务器，并请求从执行binlog日志文件中的指定位置之后开始发送binlog日志内容。<li>Master服务器接收来自Slave服务器的IO线程的请求后，负责复制的IO线程会根据Slave服务器的IO线程请求的信息<code>分批读取</code>指定binlog日志文件指定位置之后的<code>binlog日志</code>信息，然后返回给Slave端的IO线程。返回的信息中除了binlog日志内容外，还有在Master服务器端记录的IO线程。返回的信息中除了binlog中的下一个指定更新位置。<li>当Slave服务器的IO线程获取到Master服务器上IO线程发送的日志内容、日志文件及位置点后，会将binlog日志内容依次写到Slave端自身的<code>Relay Log（即中继日志）</code>文件（Mysql-relay-bin.xxx）的最末端，并将新的binlog文件名和位置记录到master-info文件中，以便下一次读取master端新binlog日志时能告诉Master服务器从新binlog日志的指定文件及位置开始读取新的binlog日志内容。<li>Slave服务器端的<code>SQL线程</code>会实时检测本地Relay Log中IO线程新增的日志内容，然后及时把Relay LOG文件中的内容<code>解析成sql语句</code>，并在自身Slave服务器上按解析SQL语句的位置顺序执行应用这样sql语句，并在relay-log.info中记录当前应用中继日志的文件名和位置点。</ol><h3 id=Oracle><a class=headerlink href=#Oracle title=Oracle></a>Oracle</h3><h3 id=SQL-Server><a title="SQL Server" class=headerlink href=#SQL-Server></a>SQL Server</h3><h3 id=Redis><a class=headerlink href=#Redis title=Redis></a>Redis</h3><h4 id=支持的数据类型><a class=headerlink href=#支持的数据类型 title=支持的数据类型></a>支持的数据类型</h4><ul><li>String<li>Hash<li>List<li>Set<li>SortedSet<li>HyperLogLog<li>Geo<li>Pub/Sub</ul><h4 id=Redis持久化><a class=headerlink href=#Redis持久化 title=Redis持久化></a>Redis持久化</h4><h5 id=RDB-全量持久化><a title="RDB (全量持久化)" class=headerlink href=#RDB-全量持久化></a>RDB (全量持久化)</h5><p>RDB 持久化机制，是对 Redis 中的数据执行周期性的持久化；RDB更适合做冷备<p><strong>优点：</strong><ul><li>会生成多个数据文件，每个数据文件分别都代表了某一时刻Redis里面的数据，很适合做冷备。完整的数据运维设置定时任务，定时同步到远端的服务器。<li>RDB对Redis的性能影响非常小，同步数据的时候只是fork了一个子进程去做持久化，数据恢复速度比AOF快。</ul><p><strong>缺点：</strong><ul><li>RDB都是快照文件，都是默认五分钟甚至更久的时间才会生成一次，这意味着你这次同步到下次同步这中间五分钟的数据都很可能全部丢失掉。<li>还有就是RDB在生成数据快照的时候，如果文件很大，客户端可能会暂停几毫秒甚至几秒。</ul><h5 id=AOF-增量持久化><a title="AOF (增量持久化)" class=headerlink href=#AOF-增量持久化></a>AOF (增量持久化)</h5><p>AOF 机制对每条写入命令作为日志，以 append-only 的模式写入一个日志文件中，因为这个模式是只追加的方式，所以没有任何磁盘寻址的开销，速度非常快，类似Mysql中的binlog。AOF更适合做热备。<p>两种机制全部开启的时候，Redis在重启的时候会默认使用AOF去重新构建数据，因为AOF的数据是比RDB更完整的。<p><strong>优点：</strong><ul><li>AOF是一秒一次去通过一个后台的线程fsync操作，最多丢这一秒的数据。<li>AOF在对日志文件进行操作的时候是以append-only的方式去写的，他只是追加的方式写数据，写入性能惊人，文件也不容易破损。<li>AOF通过可读的方式记录日志的，这样的特性适合做灾难性数据误删除的紧急恢复。</ul><p><strong>缺点：</strong><ul><li>AOF备份的文件比RDB大。<li>AOF开启后，Redis支持写的QPS会比RDB支持写的要低。</ul><h4 id=Redis集群><a class=headerlink href=#Redis集群 title=Redis集群></a>Redis集群</h4><h5 id=主从复制><a class=headerlink href=#主从复制 title=主从复制></a>主从复制</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224084745.png><p><code>主从复制</code>主要实现了数据的多机备份以及对于读操作的负载均衡和简单的故障恢复。<p><code>从节点作用</code>: 一旦主节点宕机，从节点作为主节点的备份可以随时顶上来。扩展主节点的读能力，分担主节点读压力。<p><code>缺陷</code>:<ul><li>一旦主节点宕机，从节点晋升成主节点，同时需要修改应用方的主节点地址，还需要命令所有从节点 去复制新的主节点，整个过程<code>需要人工干预</code>。<li>主节点的<code>写能力</code>和<code>存储能力</code>均受单机的限制。<li>原生复制的弊端在早期的版本中也会比较突出，比如：Redis复制中断后，从节点会发起 psync。此时如果同步不成功，则会进行全量同步，主库执行全量备份的同时，可能会造成毫秒或秒级的卡顿。</ul><p><code>全量同步</code>:<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224085014.png><p><code>增量同步</code>:<p>Slave初始化后开始正常工作时主服务器发生的写操作同步到从服务器的过程。 增量复制的过程主要是主服务器每执行一个写命令就会向从服务器发送相同的写命令，从服务器接收并执行收到的写命令。<p><code>同步策略</code>:<ul><li>主从刚刚连接的时候，进行全量同步；<li>全同步结束后，进行增量同步。当然，slave在任何时候都可以发起全量同步。redis策略是，首先尝试进行增量同步，如不成功，则进行全量同步。</ul><blockquote><p>如果多个Slave断线了，需要重启的时候，因为只要Slave启动，就会发送sync请求和主机全量同步，当多个同时出现的时候，可能会导致Master IO剧增导致宕机。<br>建议开启master主服务器的持久化功能，避免出现master重启后，数据无法恢复；</blockquote><h5 id=Redis-Sentinal（哨兵模式）><a title="Redis Sentinal（哨兵模式）" class=headerlink href=#Redis-Sentinal（哨兵模式）></a>Redis Sentinal（哨兵模式）</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223203331.png><p><code>实现原理</code>：<ol><li>每个Sentinel以每秒钟一次的频率，向它所知的主服务器、从服务器以及其他Sentinel实例发送一个PING命令。<li>如果一个实例（instance）距离最后一次有效回复PING命令的时间超过down-after-milliseconds 所指定的值，那么这个实例会被 Sentinel 标记为主观下线。<li>如果一个主服务器被标记为主观下线，那么正在监视这个主服务器的所有Sentinel节点，要以每秒一次的频率确认主服务器的确进入了主观下线状态。<li>如果一个主服务器被标记为主观下线，并且有足够数量的 Sentinel（至少要达到配置文件指定的数量）在指定的时间范围内同意这一判断，那么这个主服务器被标记为客观下线。<li>在一般情况下，每个 Sentinel 会以每10秒一次的频率，向它已知的所有主服务器和从服务器 发送INFO命令。当一个主服务器被 Sentinel 标记为客观下线时，Sentinel 向下线主服务器的所有从服务器发送INFO命令的频率，会从10秒一次改为每秒一次。<li>Sentinel 和其他 Sentinel 协商主节点的状态，如果主节点处于SDOWN状态，则投票自动选出新的主节点。将剩余的从节点指向新的主节点进行数据复制。<li>当没有足够数量的 Sentinel 同意主服务器下线时，主服务器的客观下线状态就会被移除。当 主服务器重新向 Sentinel 的PING命令返回有效回复时，主服务器的主观下线状态就会被移除。</ol><p><code>Redis Sentinal</code>: 在复制的基础上，哨兵实现了自动化故障恢复。<p><code>缺陷</code>: 写操作无法负载均衡，存储能力受单机限制。<h5 id=Redis-Cluster><a title="Redis Cluster" class=headerlink href=#Redis-Cluster></a>Redis Cluster</h5><p><code>Redis Cluster</code>: 解决了写操作无法负载均衡以及存储能力受到单机限制的问题，实现了较为完善的高可用方案。<h4 id=一致性hash><a class=headerlink href=#一致性hash title=一致性hash></a>一致性hash</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223205013.png><p><code>一致性哈希</code>可以很好的解决稳定性问题，可以将所有的存储节点排列在首尾相接的Hash环上，每个 key在计算Hash后会顺时针找到临接的存储节点存放。而当有节点加入或退出时，仅影响该节点在 Hash环上顺时针相邻的后续节点。<h5 id=虚拟节点><a class=headerlink href=#虚拟节点 title=虚拟节点></a>虚拟节点</h5><p>为了解决这种数据倾斜问题，一致性Hash算法引入了虚拟节点机制，即对每一个服务节点计算多个哈希，每个计算结果位置都放置一个此服务节点，称为虚拟节点。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223213150.png><h4 id=淘汰策略><a class=headerlink href=#淘汰策略 title=淘汰策略></a>淘汰策略</h4><ul><li><code>noeviction</code>: 不删除策略, 达到最大内存限制时, 直接返回错误信息；<li><code>allkeys-lru</code>: 所有key通用，优先删除最近最少使用(less recently used, LRU) 的 key；<li><code>volatile-lru</code>: 只限于设置了expire的部分; 优先删除最近最少使用(less recently used, LRU) 的key；<li><code>allkeys-random</code>: 所有key通用，随机删除一部分key；<li><code>volatile-random</code>: 只限于设置了expire的部分，随机删除一部分key；<li><code>volatile-ttl</code>: 只限于设置了expire的部分，优先删除剩余时间(time to live, TTL) 短的key；</ul><h3 id=Memcache><a class=headerlink href=#Memcache title=Memcache></a>Memcache</h3><h4 id=Memcache-特点><a title="Memcache 特点" class=headerlink href=#Memcache-特点></a>Memcache 特点</h4><ul><li>处理请求时使用多线程异步 IO 的方式，可以合理利用 CPU 多核的优势，性能非常优秀；<li>功能简单，使用内存存储数据；<li>对缓存的数据可以设置失效期，过期后的数据会被清除；<li>失效的策略采用延迟失效，就是当再次使用数据时检查是否失效；<li>当容量存满时，会对缓存中的数据进行剔除，剔除时除了会对过期 key 进行清理，还会按 LRU 策略对数据进行剔除。</ul><h4 id=Memcache-缺点><a title="Memcache 缺点" class=headerlink href=#Memcache-缺点></a>Memcache 缺点</h4><ul><li>key 不能超过 250 个字节；<li>value 不能超过 1M 字节；<li>key 的最大失效时间是 30 天；<li>只支持 K-V 结构，不提供持久化和主从同步功能；</ul><h3 id=MongoDB><a class=headerlink href=#MongoDB title=MongoDB></a>MongoDB</h3><h3 id=缓存常见问题><a class=headerlink href=#缓存常见问题 title=缓存常见问题></a>缓存常见问题</h3><h4 id=缓存雪崩><a class=headerlink href=#缓存雪崩 title=缓存雪崩></a>缓存雪崩</h4><p><code>缓存雪崩</code>是指缓存在同一时间同时失效，造成大量请求直接打到数据库上，导致数据库被打死。<p><strong>解法:</strong><p>在批量往Redis存数据的时候，把每个Key的失效时间都加个随机值就好了，这样可以保证数据不会在同一时间大面积失效。<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>setRedis（Key，value，time + Math.random() * 10000）；</span><br></pre></table></figure><h4 id=缓存穿透><a class=headerlink href=#缓存穿透 title=缓存穿透></a>缓存穿透</h4><p><code>缓存穿透</code>是指缓存和数据库中都没有的数据，而用户不断发起请求，我们数据库的 id 都是1开始自增上去的，如发起为id值为<code>-1</code>的数据或id为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大，严重会击垮数据库。<p><strong>解法：</strong><ul><li>对请求参数加校验，不合法的参数直接代码Return；<li>自动将不存在的key添加到缓存中（value=null），有效时间可以设短点儿；<li>Nginx上也可以加请求阈值判断，将单秒内发起这么多次请求的IP拉黑；<li>布隆过滤器（BloomFilter）：利用高效的数据结构和算法快速判断出Key是否在数据库中存在，不存在直接return；存在就去查了DB刷新KV再return；</ul><h4 id=缓存击穿><a class=headerlink href=#缓存击穿 title=缓存击穿></a>缓存击穿</h4><p><code>缓存击穿</code>是指一个Key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个Key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库。<p><strong>解法：</strong><ul><li>可设置热点数据永不过期；<li>加互斥锁；</ul><h3 id=分布式锁><a class=headerlink href=#分布式锁 title=分布式锁></a>分布式锁</h3><h4 id=Redis分布式锁><a class=headerlink href=#Redis分布式锁 title=Redis分布式锁></a>Redis分布式锁</h4><p>分布式锁要确保以下四个条件：<ul><li><code>互斥性</code>：在任意时刻，只有一个客户端能持有锁；<li><code>不会发生死锁</code>：即使有一个客户端在持有锁的期间崩溃而没有主动解锁，也能保证后续其他客户端能加锁；<li><code>具有容错性</code>：只要大部分的Redis节点正常运行，客户端就可以加锁和解锁；<li><code>加锁和解锁必须是同一个客户端</code>：客户端自己不能把别人加的锁给解了；</ul><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">RedisTool</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>static</span> <span class=keyword>final</span> <span class=type>String</span> <span class=variable>LOCK_SUCCESS</span> <span class=operator>=</span> <span class=string>"OK"</span>;</span><br><span class=line></span><br><span class=line>    <span class=comment>/**</span></span><br><span class=line><span class=comment>     * 尝试获取分布式锁</span></span><br><span class=line><span class=comment>     * <span class=doctag>@param</span> jedis Redis客户端</span></span><br><span class=line><span class=comment>     * <span class=doctag>@param</span> lockKey 锁</span></span><br><span class=line><span class=comment>     * <span class=doctag>@param</span> requestId 请求标识</span></span><br><span class=line><span class=comment>     * <span class=doctag>@param</span> expireTime 超期时间</span></span><br><span class=line><span class=comment>     * <span class=doctag>@return</span> 是否获取成功</span></span><br><span class=line><span class=comment>     */</span></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=type>boolean</span> <span class="title function_">tryGetDistributedLock</span><span class=params>(Jedis jedis, String lockKey, String requestId, <span class=type>int</span> expireTime)</span> {</span><br><span class=line></span><br><span class=line>        <span class=type>String</span> <span class=variable>result</span> <span class=operator>=</span> jedis.set(lockKey, requestId, <span class=string>"NX"</span>, <span class=string>"PX"</span>, expireTime);</span><br><span class=line></span><br><span class=line>        <span class=keyword>if</span> (LOCK_SUCCESS.equals(result)) {</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>true</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>false</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h5 id=Redis集群分布式锁（RedLock）><a class=headerlink href=#Redis集群分布式锁（RedLock） title=Redis集群分布式锁（RedLock）></a>Redis集群分布式锁（RedLock）</h5><ol><li>获取当前时间的毫秒数<code>T1</code>。<li>按顺序依次向<code>N个Redis节点</code>执行获取锁的操作。这个获取锁的操作基于Redis单节点获取锁的过程相同。为了保证在某个Redis节点不可用的时候算法能够继续运行，这个获取锁的操作还需要一个<code>超时时间</code>，它应该远小于锁的过期时间。客户端向某个Redis节点获取锁失败后，应立即尝试下一个Redis节点。这里失败包括Redis节点不可用或者该Redis节点上的锁已经被其他客户端持有。<li>计算整个获取锁过程的总耗时。即当前时间减去第一步记录的时间。计算公司为<code>T2=now()- T1</code>。如果客户端从大多数Redis节点(>N/2 +1)成功获取到锁。并且获取锁总共消耗的时间小于锁的过期时间（即<code>T2&lt;expireTime</code>）。则认为客户端获取锁成功，否则，认为获取锁失败；<li>如果获取锁成功，需要重新计算锁的过期时间。它等于最初锁的有效时间减去第三步计算出来获取锁消耗的时间，即<code>expireTime - T2</code>；<li>如果最终获取锁失败，那么客户端立即向所有Redis节点发起释放锁的操作。</ol><p>　　<br>虽然说RedLock算法可以解决单点Redis分布式锁的安全性问题，但如果集群中有节点发生崩溃重启，还是会对锁的安全性有影响的。<p>具体出现问题的场景如下：<p>假设一共有5个Redis节点：A, B, C, D, E。设想发生了如下的事件序列：<ol><li>客户端1成功锁住了A, B, C，获取锁成功（但D和E没有锁住）；<li>节点C崩溃重启了，但客户端1在C上加的锁没有持久化下来，丢失了；<li>节点C重启后，客户端2锁住了C, D, E，获取锁成功；</ol><p>这样，客户端1和客户端2同时获得了锁（针对同一资源）。针对这样场景，解决方式也很简单，也就是让Redis崩溃后延迟重启，并且这个延迟时间大于锁的过期时间就好。这样等节点重启后，所有节点上的锁都已经失效了。也不存在以上出现2个客户端获取同一个资源的情况了。<p>相比之下，RedLock安全性和稳定性都Redis单节点锁好很多，但要说完全没有问题不是。例如，如果客户端获取锁成功后，如果访问共享资源操作执行时间过长，导致锁过期了，后续客户端获取锁成功了，这样在同一个时刻又出现了2个客户端获得了锁的情况。<p>所以针对分布式锁的应用的时候需要多测试。服务器台数越多，出现不可预期的情况也越多。如果客户端获取锁之后，在上面第三步发生了GC得情况导致GC完成后，锁失效了，这样同时也使得同一时间有2个客户端获得了锁。<p>如果系统对共享资源有非常严格要求得情况下，还是建议需要做<code>数据库锁</code>方案来补充。如飞机票或火车票座位得情况。对于一些抢购获取，针对偶尔出现超卖，后续可以人为沟通置换得方式采用分布式锁得方式没什么问题，因为可以绝大部分保证分布式锁的安全性。<h4 id=数据库分布式锁><a class=headerlink href=#数据库分布式锁 title=数据库分布式锁></a>数据库分布式锁</h4><h5 id=基于数据库表><a class=headerlink href=#基于数据库表 title=基于数据库表></a>基于数据库表</h5><p>比如要对某个方法加锁，创建一张锁表，添加如下字段: <code>方法名，时间戳</code>，<code>方法名</code>字段有唯一性索引。<p>当需要锁住某个方法时，往该表中插入一条相关的记录。如果有多个请求同时提交到数据库，数据库会保证只有一个操作可以成功，那么操作成功的那个线程就获得了该方法的锁。<h5 id=基于数据库排他锁><a class=headerlink href=#基于数据库排他锁 title=基于数据库排他锁></a>基于数据库排他锁</h5><p>在查询语句后面增加<code>for update</code>，数据库会在查询过程中给数据库表增加排他锁。当某条记录被加上排他锁之后，其他线程无法再在该行记录上增加排他锁。其他没有获取到锁的就会阻塞在上述select语句上，可能的结果有2种，在超时之后获取到了锁，在超时之前仍未获取到锁。<p>获得排它锁的线程即可获得分布式锁，当获取到锁之后，可以执行方法的业务逻辑，执行完方法之后，释放锁<code>connection.commit()</code>。<p><code>存在的问题</code>：主要是性能不高和sql超时的异常。<h4 id=Zookeeper分布式锁><a class=headerlink href=#Zookeeper分布式锁 title=Zookeeper分布式锁></a>Zookeeper分布式锁</h4><p>基于Zookeeper<code>临时有序节点</code>实现的分布式锁: 每个客户端对某个方法加锁时，在zookeeper上与该方法对应的指定节点的目录下，生成一个唯一的瞬时有序节点。<p>判断是否获取锁的方式很简单，只需要判断有序节点中序号最小的一个。<p>当释放锁的时候，只需将这个瞬时节点删除即可。<h2 id=服务注册-发现><a class=headerlink href=#服务注册-发现 title=服务注册/发现></a>服务注册/发现</h2><table><thead><tr><th><th>Nacos<th>Eureka<th>Consul<th>Etcd<th>Zookeeper<tbody><tr><td>一致性协议<td>CP + AP<td>AP<td>CP<td>CP<td>CP<tr><td>健康检查<td>TCP/HTTP/MySQL/Client Beat<td>Client Beat<td>TCP/HTTP/gRPC/cmd<td>Keep Alive<td>Keep Alive<tr><td>负载均衡策略<td>权重/metadata/selector<td>Ribbon<td>Fabio<td><td><tr><td>雪崩保护<td>有<td>有<td>无<td>无<td>无<tr><td>自动注销实例<td>支持<td>支持<td>不支持<td><td>支持<tr><td>访问协议<td>HTTP/DNS<td>HTTP<td>HTTP/DNS<td><td>TCP<tr><td>监听支持<td>支持<td>支持<td>支持<td><td>支持<tr><td>多数据中心<td>不支持<td>不支持<td><td><td>不支持<tr><td>跨注册中心同步<td>支持<td>不支持<td>支持<td><td>不支持<tr><td>Spring Cloud 集成<td>支持<td>支持<td>支持<td>支持<td>支持<tr><td>Dubbo 集成<td>支持<td>不支持<td>不支持<td><td>支持<tr><td>k8s 集成<td>支持<td>不支持<td>支持<td><td>不支持<tr><td>key-value 存储服务<td><td>不支持<td>支持<td>支持<td>支持<tr><td>安全<td><td>不支持<td>acl/https<td>https支持（弱）<td>acl<tr><td>watch支持<td><td>支持long polling/大部分增量<td>全量/支持long polling<td>支持long polling<td>支持</table><h3 id=Zookeeper><a class=headerlink href=#Zookeeper title=Zookeeper></a>Zookeeper</h3><h3 id=Etcd><a class=headerlink href=#Etcd title=Etcd></a>Etcd</h3><h3 id=Consul><a class=headerlink href=#Consul title=Consul></a>Consul</h3><h3 id=Euraka><a class=headerlink href=#Euraka title=Euraka></a>Euraka</h3><p>云端服务发现，一个基于 REST 的服务，用于定位服务，以实现云端中间层服务发现和故障转移。<h2 id=API-Gateway-服务网关><a title="API Gateway (服务网关)" class=headerlink href=#API-Gateway-服务网关></a>API Gateway (服务网关)</h2><h3 id=Zuul><a class=headerlink href=#Zuul title=Zuul></a>Zuul</h3><p>在云平台上提供动态路由,监控,弹性,安全等边缘服务的框架。Zuul 相当于是设备和 Netflix 流应用的 Web 网站后端所有请求的前门。<h3 id=Spring-Cloud-Gateway><a title="Spring Cloud Gateway" class=headerlink href=#Spring-Cloud-Gateway></a>Spring Cloud Gateway</h3><h3 id=Kong><a class=headerlink href=#Kong title=Kong></a>Kong</h3><h2 id=负载均衡><a class=headerlink href=#负载均衡 title=负载均衡></a>负载均衡</h2><h3 id=Nginx-7层><a title="Nginx (7层)" class=headerlink href=#Nginx-7层></a>Nginx (7层)</h3><h4 id=Nginx负载均衡策略><a class=headerlink href=#Nginx负载均衡策略 title=Nginx负载均衡策略></a>Nginx负载均衡策略</h4><ul><li>轮询rr<li>加权轮询<li>IP hash<li>URL hash<li>Fair</ul><h3 id=Haproxy-7层><a title="Haproxy (7层)" class=headerlink href=#Haproxy-7层></a>Haproxy (7层)</h3><h3 id=LVS-4层><a title="LVS (4层)" class=headerlink href=#LVS-4层></a>LVS (4层)</h3><p>相关术语<ul><li><strong>DS</strong>：Director Server。指的是前端负载均衡器节点。<li><strong>RS</strong>：Real Server。后端真实的工作服务器。<li><strong>VIP</strong>：向外部直接面向用户请求，作为用户请求的目标的IP地址。<li><strong>DIP</strong>：Director Server IP，主要用于和内部主机通讯的IP地址。<li><strong>RIP</strong>：Real Server IP，后端服务器的IP地址。<li><strong>CIP</strong>：Client IP，访问客户端的IP地址。</ul><h4 id=3种负载均衡模型><a class=headerlink href=#3种负载均衡模型 title=3种负载均衡模型></a>3种负载均衡模型</h4><h5 id=NAT模型><a class=headerlink href=#NAT模型 title=NAT模型></a>NAT模型</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223180505.png><p>NAT模型特点：<ul><li>RS应该使用私有地址，RS的网关必须指向DIP；<li>DIP和RIP必须在同一个网段内；<li>请求和响应报文都需要经过Director Server，高负载场景中，Director Server易成为性能瓶颈；<li>支持端口映射；<li>RS可以使用任意操作系统；<li>缺陷：请求和响应都需经过director server，对Director Server压力会比较大；</ul><h5 id=DR模型-Direct-Route><a title="DR模型 (Direct Route)" class=headerlink href=#DR模型-Direct-Route></a>DR模型 (Direct Route)</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223180656.png><p>DR模型特点：<ul><li>保证前端路由将目标地址为VIP报文统统发给Director Server，而不是RS；<li>RS可以使用私有地址；也可以是公网地址，如果使用公网地址，此时可以通过互联网对RIP进行直接访问；<li>RS跟Director Server必须在同一个物理网络中；<li>所有的请求报文经由Director Server，但响应报文必须不能进过Director Server；<li>不支持地址转换，也不支持端口映射；<li>RS可以是大多数常见的操作系统；<li>RS的网关绝不允许指向DIP(因为不允许经过director server)；<li>RS上的lo接口配置VIP的IP地址；<li>缺陷：RS和DS必须在同一机房中；</ul><p>解决方案：<ul><li>在前端路由器做静态地址路由绑定，将对于VIP的地址仅路由到Director Server；<li>存在问题：用户未必有路由操作权限，因为有可能是运营商提供的，所以这个方法未必实用；<li>arptables：在arp的层次上实现在ARP解析时做防火墙规则，过滤RS响应ARP请求。这是由iptables提供的；<li>修改RS上内核参数（arp_ignore和arp_announce）将RS上的VIP配置在lo接口的别名上，并限制其不能响应对VIP地址解析请求；</ul><h5 id=TUN模型><a class=headerlink href=#TUN模型 title=TUN模型></a>TUN模型</h5><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191223180906.png><p>Tun模型特性<ul><li>RIP、VIP、DIP全是公网地址；<li>RS的网关不会也不可能指向DIP；<li>所有的请求报文经由Director Server，但响应报文必须不能进过Director Server；<li>不支持端口映射；<li>RS的系统必须支持隧道；</ul><h4 id=LVS负载均衡调度算法><a class=headerlink href=#LVS负载均衡调度算法 title=LVS负载均衡调度算法></a>LVS负载均衡调度算法</h4><ul><li><p><code>轮询 rr</code>: 这种算法是最简单的，就是按依次循环的方式将请求调度到不同的服务器上，该算法最大的特点就是简单。轮询算法假设所有的服务器处理请求的能力都是一样的，调度器会将所有的请求平均分配给每个真实服务器，不管后端 RS 配置和处理能力，非常均衡地分发下去。</p><li><p><code>加权轮询 wrr</code>: 这种算法比 rr 的算法多了一个权重的概念，可以给 RS 设置权重，权重越高，那么分发的请求数越多，权重的取值范围 0 – 100。主要是对rr算法的一种优化和补充， LVS 会考虑每台服务器的性能，并给每台服务器添加要给权值，如果服务器A的权值为1，服务器B的权值为2，则调度到服务器B的请求会是服务器A的2倍。权值越高的服务器，处理的请求越多。</p><li><p><code>最少链接 lc</code>: 这个算法会根据后端 RS 的连接数来决定把请求分发给谁，比如 RS1 连接数比 RS2 连接数少，那么请求就优先发给 RS1</p><li><p><code>加权最少链接 wlc</code>: 这个算法比 lc 多了一个权重的概念。</p><li><p><code>基于局部性的最少连接调度算法 lblc</code>: 这个算法是请求数据包的目标 IP 地址的一种调度算法，该算法先根据请求的目标 IP 地址寻找最近的该目标 IP 地址所有使用的服务器，如果这台服务器依然可用，并且有能力处理该请求，调度器会尽量选择相同的服务器，否则会继续选择其它可行的服务器</p><li><p><code>复杂的基于局部性最少的连接算法 lblcr</code>: 记录的不是要给目标 IP 与一台服务器之间的连接记录，它会维护一个目标 IP 到一组服务器之间的映射关系，防止单点服务器负载过高。</p><li><p><code>目标地址散列调度算法 dh</code>: 该算法是根据目标 IP 地址通过散列函数将目标 IP 与服务器建立映射关系，出现服务器不可用或负载过高的情况下，发往该目标 IP 的请求会固定发给该服务器。</p><li><p><code>源地址散列调度算法 sh</code>: 与目标地址散列调度算法类似，但它是根据源地址散列算法进行静态分配固定的服务器资源。</p></ul><h4 id=LVS-Keepalived><a title="LVS + Keepalived" class=headerlink href=#LVS-Keepalived></a>LVS + Keepalived</h4><p>LVS可以实现负载均衡，但是不能够进行健康检查，比如一个rs出现故障，LVS 仍然会把请求转发给故障的rs服务器，这样就会导致请求的无效性。keepalived 可以进行健康检查，而且能同时实现 LVS 的高可用性，解决 LVS 单点故障的问题。<p><code>/etc/keepalived/keepalived.conf</code><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br></pre><td class=code><pre><span class=line>global_defs {</span><br><span class=line>    router_id R1 <span class=comment>## 本服务器的名称， 若环境中有多个keepalived时， 此名称不能一致</span></span><br><span class=line>}</span><br><span class=line>vrrp_instance VI_1 {</span><br><span class=line>    <span class=comment>## 定义VRRP热备实例， 每一个keep组都不同</span></span><br><span class=line>    state MASTER <span class=comment>## MASTER表示主服务器</span></span><br><span class=line>    interface eth0 <span class=comment>## 承载VIP地址的物理接口</span></span><br><span class=line>    virtual_router_id 1 <span class=comment>## 虚拟路由器的ID号， 每一个keep组都不同</span></span><br><span class=line>    priority 100 <span class=comment>## 优先级， 数值越大优先级越高</span></span><br><span class=line>    advert_int 1 <span class=comment>## 通告检查间隔秒数（ 心跳频率）</span></span><br><span class=line>    authentication {</span><br><span class=line>        <span class=comment>## 认证信息</span></span><br><span class=line>        auth_type PASS <span class=comment>## 认证类型</span></span><br><span class=line>        auth_pass 123456 <span class=comment>## 密码字串</span></span><br><span class=line>    }</span><br><span class=line>    virtual_ipaddress {</span><br><span class=line>        192.168.100.95 <span class=comment>## 指定漂移地址（ VIP）</span></span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line>virtual_server 192.168.100.95 80 {</span><br><span class=line>    <span class=comment># vip配置</span></span><br><span class=line>    delay_loop 2 <span class=comment>## 每隔2秒检查一次real_server状态</span></span><br><span class=line>    lb_algo wrr <span class=comment>## 指定lvs的调度算法</span></span><br><span class=line>    lb_kind DR <span class=comment>## lvs集群模式</span></span><br><span class=line>    persistence_timeout 60 <span class=comment>## 会话保持时间</span></span><br><span class=line>    protocol TCP <span class=comment>## 选择协议</span></span><br><span class=line>    real_server 192.168.100.101 80 {</span><br><span class=line>        <span class=comment>## 本机地址</span></span><br><span class=line>        weight: 3 <span class=comment>## 服务器的权重</span></span><br><span class=line>        notify_down / etc / keepalived / check.sh <span class=comment>## 指定节点失效后， 采用的脚本， notify_up表示节点正常后， 采用的脚本## 健康检查方式一共有HTTP_GET |</span></span><br><span class=line>            SSL_GET | TCP_CHECK | SMTP_CHECK | MISC_CHECK这些</span><br><span class=line>        TCP_CHECK {</span><br><span class=line>            connect_timeout 10 <span class=comment>## 连接超时时间</span></span><br><span class=line>            nb_get_retry 3 <span class=comment>## 重连次数</span></span><br><span class=line>            delay_before_retry 3 <span class=comment>## 重连间隔时间</span></span><br><span class=line>            connect_port 80 <span class=comment>## 健康检查端口</span></span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><code>/etc/keepalived/check.sh</code><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=meta>#!/bin/bash</span></span><br><span class=line>/etc/init.d/keepalived stop</span><br><span class=line><span class=built_in>echo</span> -e <span class=string>"<span class=subst>$(ip a |grep eth0 |grep inet |awk '{print $2}'|awk -F'/' '{print $1}')</span> (httpd) is down on <span class=subst>$(date +%F-%T)</span>"</span> >>/root/check_httpd.log</span><br></pre></table></figure><h3 id=硬件F5-A10><a title="硬件F5, A10" class=headerlink href=#硬件F5-A10></a>硬件F5, A10</h3><h3 id=Spring-Cloud-Ribbon><a title="Spring Cloud Ribbon" class=headerlink href=#Spring-Cloud-Ribbon></a>Spring Cloud Ribbon</h3><p>提供云端负载均衡，有多种负载均衡策略可供选择，可配合服务发现和断路器使用。<h2 id=熔断器><a class=headerlink href=#熔断器 title=熔断器></a>熔断器</h2><h3 id=常见限流算法><a class=headerlink href=#常见限流算法 title=常见限流算法></a>常见限流算法</h3><h4 id=漏斗><a class=headerlink href=#漏斗 title=漏斗></a>漏斗</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224150421.png><p>漏桶(Leaky Bucket)算法思路很简单，水(请求)先进入到漏桶里，漏桶以一定的速度出水(接口有响应速率)，当水流入速度过大会直接溢出(访问频率超过接口响应速率)，然后就拒绝请求，可以看出漏桶算法能强行限制数据的传输速率。<p><strong>缺点</strong>：因为漏桶的漏出速率是固定的参数，即使网络中不存在资源冲突(没有发生拥塞)，漏桶算法也不能使流突发(burst)到端口速率。因此，漏桶算法对于存在突发特性的流量来说缺乏效率。<h4 id=令牌桶><a class=headerlink href=#令牌桶 title=令牌桶></a>令牌桶</h4><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224150814.png><p>令牌桶算法(Token Bucket)和漏斗效果一样但方向相反。随着时间流逝，系统会按恒定<strong>1/QPS</strong>时间间隔(如果QPS=100，则间隔是10ms)往桶里加入Token。如果桶已经满了就不再加了，新请求来临时，会各自拿走一个Token，如果没有Token可拿了就阻塞或者拒绝服务。<p><strong>优点</strong>：令牌桶的好处是可以方便的改变速度。一旦需要提高速率，只需按需提高放入桶中的令牌的速率即可。一般会定时(比如100毫秒)往桶中增加一定数量的令牌，有些变种算法则实时的计算应该增加的令牌的数量。<h4 id=队列><a class=headerlink href=#队列 title=队列></a>队列</h4><h4 id=计数器><a class=headerlink href=#计数器 title=计数器></a>计数器</h4><h4 id=动态流控><a class=headerlink href=#动态流控 title=动态流控></a>动态流控</h4><h3 id=Hystrix><a class=headerlink href=#Hystrix title=Hystrix></a>Hystrix</h3><p>Hystrix熔断器：容错管理工具，旨在通过熔断机制控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152933.png><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224151633.png><p><strong>Turbine</strong> [‘tɝbaɪn]：是聚合服务器发送事件流数据的一个工具，用来监控集群下 hystrix 的 metrics 情况。<h4 id=隔离模式><a class=headerlink href=#隔离模式 title=隔离模式></a>隔离模式</h4><h5 id=线程池隔离模式><a class=headerlink href=#线程池隔离模式 title=线程池隔离模式></a>线程池隔离模式</h5><p>线程池隔离模式：使用一个线程池来存储当前请求，线程池对请求作处理，设置任务返回处理超时时间，堆积的请求先入线程池队列。这种方式要为每个依赖服务申请线程池，有一定的资源消耗，好处是可以应对突发流量（流量洪峰来临时，处理不完可将数据存储到线程池队里慢慢处理）。<h5 id=信号量隔离模式><a class=headerlink href=#信号量隔离模式 title=信号量隔离模式></a>信号量隔离模式</h5><p>信号量隔离模式：使用一个原子计数器（或信号量）记录当前有多少个线程在运行，请求来先判断计数器的数值，若超过设置的最大线程个数则丢弃该类型的新请求，若不超过则执行计数操作请求来计数器+1，请求返回计数器-1。这种方式是严格的控制线程且立即返回模式，无法应对突发流量（流量洪峰来临时，处理的线程超过数量，其他的请求会直接返回，不继续去请求依赖的服务）。<h4 id=降级><a class=headerlink href=#降级 title=降级></a>降级</h4><p>服务降级的目的保证上游服务的稳定性，当整体资源快不够了，将某些服务先关掉，待渡过难关，再开启回来。<h5 id=快速模式><a class=headerlink href=#快速模式 title=快速模式></a>快速模式</h5><p>如果调用服务失败了，那么立即失败并返回。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152514.png><h5 id=故障转移><a class=headerlink href=#故障转移 title=故障转移></a>故障转移</h5><p>如果调用服务失败了，那么调用备用服务，因为备用服务也可能失败，所以也可能有再下一级的备用服务，如此形成一个级联。例如：如果服务提供者不响应，则从缓存中取默认数据。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152538.png><h5 id=主次模式><a class=headerlink href=#主次模式 title=主次模式></a>主次模式</h5><p>开发中需要上线一个新功能，但为了防止新功能上线失败可以回退到老的代码，我们会做一个开关比做一个配置开关，可以动态切换到老代码功能。那么Hystrix它是使用通过一个配置来在两个command中进行切换。<p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191224152606.png><h3 id=Sentinel><a class=headerlink href=#Sentinel title=Sentinel></a>Sentinel</h3><h3 id=Resilience4j><a class=headerlink href=#Resilience4j title=Resilience4j></a>Resilience4j</h3><h2 id=配置管理><a class=headerlink href=#配置管理 title=配置管理></a>配置管理</h2><table><thead><tr><th>功能点<th>Spring Cloud Config<th>Apollo<th>Nacos<tbody><tr><td>开源时间<td>2014.09<td>2016.05<td>2018.06<tr><td>配置实时推送<td>支持（Spring Cloud Bus）<td>支持（Http长轮询,1s内）<td>支持（Http长轮询,1s内）<tr><td>版本管理<td>支持（Git）<td>支持<td>支持<tr><td>配置回滚<td>支持（Git）<td>支持<td>支持<tr><td>灰度发布<td>支持<td>支持<td>待支持<tr><td>权限管理<td>支持<td>支持<td>待支持<tr><td>多集群<td>支持<td>支持<td>支持<tr><td>多环境<td>支持<td>支持<td>支持<tr><td>监听查询<td>支持<td>支持<td>支持<tr><td>多语言<td>只支持Java<td>Go, C++, Python, PHP, Java, .NET<td>Python, Java, Node.JS<tr><td>单机部署<td>Config Server + Git + Spring Cloud Bus (支持配送实时推送)<td>Apollo quickstart + MySQL<td>Nacos单节点<tr><td>分布式部署<td>Config Server(2) + Git + MQ 部署复杂<td>Config(2) + Admin(2) + Portal(2) + MySQL 部署复杂<td>Nacos(3) + MySQL 部署简单<tr><td>配置格式校验<td>不支持<td>支持<td>支持<tr><td>通信协议<td>HTTP, AMQP<td>HTTP<td>HTTP<tr><td>数据一致性<td>Git保证数据一致性，Config Server读取Git数据<td>数据库模拟消息队列，Apollo定时读取<td>HTTP异步通知<tr><td>单机读<td>7(限流所致)<td>9000<td>15000<tr><td>单机写<td>5(限流所致)<td>1100<td>1800<tr><td>3节点读<td>21(限流所致)<td>27000<td>45000<tr><td>3节点写<td>5(限流所致)<td>3300<td>5600</table><h3 id=Spring-Cloud-Config><a title="Spring Cloud Config" class=headerlink href=#Spring-Cloud-Config></a>Spring Cloud Config</h3><p>2014年9月开源，Spring Cloud 生态组件，可以和Spring Cloud体系无缝整合。<p>Spring Cloud Config是一套配置管理工具包，让你可以把配置放到远程服务器，集中化管理集群配置，目前支持本地存储、Git以及Subversion。<p>Spring Cloud Bus：事件、消息总线，用于在集群（例如，配置变化事件）中传播状态变化，可与 Spring Cloud Config 联合实现热部署。<h3 id=Disconf><a class=headerlink href=#Disconf title=Disconf></a>Disconf</h3><p>2014年7月百度开源的配置管理中心，同样具备配置的管理能力，不过目前已经不维护了，最近的一次提交是两年前了。<h3 id=Apollo><a class=headerlink href=#Apollo title=Apollo></a>Apollo</h3><p>2016年5月，携程开源的配置管理中心，具备规范的权限、流程治理等特性。<p>携程经过生产级验证，具备高可用，配置实时生效（推拉结合），配置审计和版本化，多环境多集群支持等生产级特性，建议中大规模需要对配置集中进行治理的企业采用。<h3 id=Nacos><a class=headerlink href=#Nacos title=Nacos></a>Nacos</h3><p>2018年6月，阿里开源的配置中心，也可以做DNS和RPC的服务发现。<h2 id=调用链监控（APM）><a class=headerlink href=#调用链监控（APM） title=调用链监控（APM）></a>调用链监控（APM）</h2><table><thead><tr><th><th>CAT<th>Zipkin<th>Pinpoint<tbody><tr><td>可视化<td>有<td>有<td>有<tr><td>报表<td><code>非常丰富</code><td>少<td>中<tr><td>ServerMap<td>简单依赖图<td>简单<td><code>好</code><tr><td>埋点方式<td>侵入<td>侵入<td><code>不侵入（字节码增强）</code><tr><td>Heartbeat支持<td><code>有</code><td>无<td><code>有</code><tr><td>Metric支持<td><code>有</code><td>无<td>无<tr><td>Java/.NET客户端支持<td><code>有</code><td><code>有</code><td>只有Java<tr><td>Dashboard中文支持<td><code>好</code><td>无<td>无<tr><td>社区支持<td><code>好，文档较丰富，有中文社区</code><td>好，文档一般，无中文社区<td>一般，文档少，无中文社区<tr><td>国内案例<td>携程、点评、陆金所<td>京东<td>暂无<tr><td>源头祖先<td>eBay CAL<td>Google Dapper<td>Google Dapper</table><h3 id=Zipkin><a class=headerlink href=#Zipkin title=Zipkin></a>Zipkin</h3><h3 id=CAT><a class=headerlink href=#CAT title=CAT></a>CAT</h3><h3 id=Pinpoint><a class=headerlink href=#Pinpoint title=Pinpoint></a>Pinpoint</h3><h3 id=Spring-Cloud-Sleuth><a title="Spring Cloud Sleuth" class=headerlink href=#Spring-Cloud-Sleuth></a>Spring Cloud Sleuth</h3><h3 id=Skywalking><a class=headerlink href=#Skywalking title=Skywalking></a>Skywalking</h3><h2 id=日志-监控><a class=headerlink href=#日志-监控 title=日志/监控></a>日志/监控</h2><h3 id=ELK-Elasticsearch-Logstash-Kibina><a title="ELK (Elasticsearch + Logstash + Kibina)" class=headerlink href=#ELK-Elasticsearch-Logstash-Kibina></a>ELK (Elasticsearch + Logstash + Kibina)</h3><h3 id=Prometheus-Grafana><a title="Prometheus + Grafana" class=headerlink href=#Prometheus-Grafana></a>Prometheus + Grafana</h3><h3 id=Zabbix><a class=headerlink href=#Zabbix title=Zabbix></a>Zabbix</h3><h3 id=Nagios><a class=headerlink href=#Nagios title=Nagios></a>Nagios</h3><h3 id=Spring-Cloud-Sleuth-sluθ-：><a title="Spring Cloud Sleuth [sluθ]：" class=headerlink href=#Spring-Cloud-Sleuth-sluθ-：></a>Spring Cloud Sleuth [sluθ]：</h3><p>日志收集工具包，封装了Dapper和log-based追踪以及Zipkin和HTrace操作，为SpringCloud应用实现了一种分布式追踪解决方案。<h2 id=安全><a class=headerlink href=#安全 title=安全></a>安全</h2><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023095848.png><ol><li>使用支持 OAuth 2.0 和 OpenID Connect 标准协议的授权服务器（个人建议定制自研）；<li>使用 API 网关作为单一访问入口，统一实现安全治理；<li>客户在访问微服务之前，先通过授权服务器登录获取 access token，然后将 access token 和请求一起发送到网关；<li>网关获取 access token，通过授权服务器校验 token，同时做 token 转换获取 JWT token。<li>网关将 JWT Token 和请求一起转发到后台微服务；<li>JWT 中可以存储用户会话信息，该信息可以传递给后台的微服务，也可以在微服务之间传递，用作认证授权等用途；<li>每个微服务包含 JWT 客户端，能够解密 JWT 并获取其中的用户会话信息。<li>整个方案中，access token 是一种 by reference token，不包含用户信息可以直接暴露在公网上；JWT token 是一种 by value token，可以包含用户信息但不暴露在公网上。</ol><h3 id=OAuth2><a class=headerlink href=#OAuth2 title=OAuth2></a>OAuth2</h3><h3 id=JWT><a class=headerlink href=#JWT title=JWT></a>JWT</h3><h2 id=服务部署平台><a class=headerlink href=#服务部署平台 title=服务部署平台></a>服务部署平台</h2><h3 id=集群资源调度系统><a class=headerlink href=#集群资源调度系统 title=集群资源调度系统></a>集群资源调度系统</h3><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023133305.png><p>首选k8s。<h4 id=Kubernetes-k8s><a title="Kubernetes (k8s)" class=headerlink href=#Kubernetes-k8s></a>Kubernetes (k8s)</h4><h4 id=Mesos><a class=headerlink href=#Mesos title=Mesos></a>Mesos</h4><h4 id=Docker-Swarm><a title="Docker Swarm" class=headerlink href=#Docker-Swarm></a>Docker Swarm</h4><h3 id=版本控制><a class=headerlink href=#版本控制 title=版本控制></a>版本控制</h3><h4 id=Github><a class=headerlink href=#Github title=Github></a>Github</h4><h4 id=Gitlab><a class=headerlink href=#Gitlab title=Gitlab></a>Gitlab</h4><h3 id=容器平台><a class=headerlink href=#容器平台 title=容器平台></a>容器平台</h3><h4 id=Docker><a class=headerlink href=#Docker title=Docker></a>Docker</h4><h4 id=AWS><a class=headerlink href=#AWS title=AWS></a>AWS</h4><h4 id=阿里云><a class=headerlink href=#阿里云 title=阿里云></a>阿里云</h4><h4 id=Google-Cloud><a title="Google Cloud" class=headerlink href=#Google-Cloud></a>Google Cloud</h4><h3 id=镜像治理><a class=headerlink href=#镜像治理 title=镜像治理></a>镜像治理</h3><h4 id=Harbor><a class=headerlink href=#Harbor title=Harbor></a>Harbor</h4><h3 id=配置管理-1><a class=headerlink href=#配置管理-1 title=配置管理></a>配置管理</h3><h4 id=Chef><a class=headerlink href=#Chef title=Chef></a>Chef</h4><h4 id=Puppet><a class=headerlink href=#Puppet title=Puppet></a>Puppet</h4><h4 id=Ansible><a class=headerlink href=#Ansible title=Ansible></a>Ansible</h4><h3 id=持续集成（CI）><a class=headerlink href=#持续集成（CI） title=持续集成（CI）></a>持续集成（CI）</h3><h4 id=Jenkins><a class=headerlink href=#Jenkins title=Jenkins></a>Jenkins</h4><h4 id=Travis-CI><a title="Travis CI" class=headerlink href=#Travis-CI></a>Travis CI</h4><h3 id=持续发布（CD）><a class=headerlink href=#持续发布（CD） title=持续发布（CD）></a>持续发布（CD）</h3><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023100350.png><ol><li>应用通过 CI 集成后生成镜像，用户将镜像推到镜像治理中心；<li>用户在资产治理中心申请发布，填报应用，发布和配额相关信息，然后等待审批通过；<li>发布审批通过，开发人员通过发布控制台发布应用；<li>发布系统通过查询资产治理中心获取发布规格信息；<li>发布系统向容器云发出启动容器实例指令；<li>容器云从镜像治理中心拉取镜像并启动容器；<li>容器内服务启动后自注册到服务注册中心，并保持定期心跳；<li>用户通过发布系统调用服务注册中心调拨流量，实现蓝绿，金丝雀或灰度发布等机制；<li>网关和内部微服务客户端定期同步服务注册中心上的服务路由表，将流量按负载均衡策略分发到新的服务实例上。</ol><p><img src=https://wangfanggang.oss-cn-shanghai.aliyuncs.com/images/20191023100603.png><h4 id=Harbor-1><a class=headerlink href=#Harbor-1 title=Harbor></a>Harbor</h4><h2 id=高可用分布式锁><a class=headerlink href=#高可用分布式锁 title=高可用分布式锁></a>高可用分布式锁</h2><h3 id=存储层产品><a class=headerlink href=#存储层产品 title=存储层产品></a>存储层产品</h3><table><thead><tr><th><th>Redis<th>Zookeeper<th>Etcd<tbody><tr><td>一致性算法<td>无<td>Paxos<td>Raft<tr><td>CAP<td>AP<td>CP<td>CP/AP<tr><td>高可用<td>主从<td>N+1可用<td>N+1可用<tr><td>接口类型<td>客户端<td>客户端<td>http/gRPC<tr><td>实现<td>setNX<td>createEphemeral<td>RESTful API</table><h4 id=Redis-1><a class=headerlink href=#Redis-1 title=Redis></a>Redis</h4><h4 id=Zookeeper-1><a class=headerlink href=#Zookeeper-1 title=Zookeeper></a>Zookeeper</h4><h4 id=Etcd-1><a class=headerlink href=#Etcd-1 title=Etcd></a>Etcd</h4><h2 id=压测工具><a class=headerlink href=#压测工具 title=压测工具></a>压测工具</h2><p>压测极限标准：<ul><li>机器 load average 不超过CPU核数 * 0.6<li>服务进程CPU占用率不超过 (CPU核数 * 0.6) * 100/机器部署的服务进程数<li>网卡流量不超过网卡容量的60%（超过可能延时较大）<li>请求超时不超过十万分之一<li>QPS不低于预估的85%，否则需要优化或给出合理解释</ul><h3 id=JMeter><a class=headerlink href=#JMeter title=JMeter></a>JMeter</h3><p>用于对服务器、网络或对象模拟巨大的负荷，在不同压力类别下测试它们的强度，分析整体性能。<br>支持分布式压测。<h3 id=TCPCopy><a class=headerlink href=#TCPCopy title=TCPCopy></a>TCPCopy</h3><p>流量复制工具，能够把线上机器的流量导流到压测环境的机器上。<br>为营造巨大压力情况，使用Tcpdump录制请求，然后使用TCPCopy回放功能产生巨大压力。<h3 id=Apache-ab><a title="Apache ab" class=headerlink href=#Apache-ab></a>Apache ab</h3><p>基于http的方式。<h2 id=IM><a class=headerlink href=#IM title=IM></a>IM</h2><h3 id=Slack><a class=headerlink href=#Slack title=Slack></a>Slack</h3><h3 id=钉钉><a class=headerlink href=#钉钉 title=钉钉></a>钉钉</h3></div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者： </strong>王方钢 / Kenny Wang<li class=post-copyright-link><strong>本文链接：</strong> <a href=https://wangfanggang.com/IT/it_study/ title=IT知识点整理>https://wangfanggang.com/IT/it_study/</a><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</ul></div><div class=post-tags><a href=/tags/Cloud/ rel=tag># Cloud</a><a href=/tags/Architecture/ rel=tag># Architecture</a><a href=/tags/IT/ rel=tag># IT</a><a href=/tags/Solution/ rel=tag># Solution</a></div><div class="social-like a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share rel=noopener target=_blank></a><a class=a2a_button_facebook></a><a class=a2a_button_twitter></a><a class=a2a_button_wechat></a></div><div class=post-nav><div class=post-nav-item><a title="Oracle APEX 活跃博文整理 | 2019.11.25" href=/Oracle/Oracle-APEX/apex-update-20191125/ rel=prev> <i class="fa fa-angle-left"></i> Oracle APEX 活跃博文整理 | 2019.11.25 </a></div><div class=post-nav-item><a title="Oracle APEX 活跃博文整理 | 2019.12.28" href=/Oracle/Oracle-APEX/apex-update-20191228/ rel=next> Oracle APEX 活跃博文整理 | 2019.12.28 <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2017 – <span itemprop=copyrightYear>2025</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>王方钢 / Kenny Wang</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>326k</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>19:46</span> </span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/muse/ rel=noopener target=_blank>NexT.Muse</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript>